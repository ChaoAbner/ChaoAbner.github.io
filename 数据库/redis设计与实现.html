<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据结构与对象 | 文档测试</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Curriculum Vitae">
    <link rel="preload" href="/assets/css/0.styles.40e1e164.css" as="style"><link rel="preload" href="/assets/js/app.1b94221b.js" as="script"><link rel="preload" href="/assets/js/2.60568d92.js" as="script"><link rel="preload" href="/assets/js/30.a98a6693.js" as="script"><link rel="prefetch" href="/assets/js/10.3d4294c4.js"><link rel="prefetch" href="/assets/js/11.14a477ac.js"><link rel="prefetch" href="/assets/js/12.a5ddb7e5.js"><link rel="prefetch" href="/assets/js/13.aae5c909.js"><link rel="prefetch" href="/assets/js/14.ab694e76.js"><link rel="prefetch" href="/assets/js/15.64315535.js"><link rel="prefetch" href="/assets/js/16.73da9ac4.js"><link rel="prefetch" href="/assets/js/17.a93d8ff3.js"><link rel="prefetch" href="/assets/js/18.b4ced15b.js"><link rel="prefetch" href="/assets/js/19.638c9ba4.js"><link rel="prefetch" href="/assets/js/20.b2eb7bf9.js"><link rel="prefetch" href="/assets/js/21.48394f3a.js"><link rel="prefetch" href="/assets/js/22.35e8a3cc.js"><link rel="prefetch" href="/assets/js/23.552730b3.js"><link rel="prefetch" href="/assets/js/24.e9135eeb.js"><link rel="prefetch" href="/assets/js/25.81b2ea1d.js"><link rel="prefetch" href="/assets/js/26.75302b23.js"><link rel="prefetch" href="/assets/js/27.9e876760.js"><link rel="prefetch" href="/assets/js/28.57922220.js"><link rel="prefetch" href="/assets/js/29.68fbb04d.js"><link rel="prefetch" href="/assets/js/3.fe45d089.js"><link rel="prefetch" href="/assets/js/31.8202c39f.js"><link rel="prefetch" href="/assets/js/32.febfda4f.js"><link rel="prefetch" href="/assets/js/33.5ae3ee39.js"><link rel="prefetch" href="/assets/js/34.15947107.js"><link rel="prefetch" href="/assets/js/35.d3f8c53a.js"><link rel="prefetch" href="/assets/js/36.b7fee681.js"><link rel="prefetch" href="/assets/js/37.c13c8f17.js"><link rel="prefetch" href="/assets/js/38.793a8df9.js"><link rel="prefetch" href="/assets/js/4.4d86075a.js"><link rel="prefetch" href="/assets/js/5.d5b9441a.js"><link rel="prefetch" href="/assets/js/6.19d672a5.js"><link rel="prefetch" href="/assets/js/7.5f6998cb.js"><link rel="prefetch" href="/assets/js/8.f35ecf57.js"><link rel="prefetch" href="/assets/js/9.99850ec9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.40e1e164.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档测试</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/数据库/redis的原子性.html" class="sidebar-link">redis的原子性</a></li><li><a href="/数据库/MongoDB总结.html" class="sidebar-link">MongoDB总结</a></li><li><a href="/数据库/redis的数据库.html" class="sidebar-link">redis的数据库</a></li><li><a href="/数据库/MySQL基础与高级.html" class="sidebar-link">基础</a></li><li><a href="/数据库/MongoDB权威指南.html" class="sidebar-link">MongoDB权威指南</a></li><li><a href="/数据库/redis设计与实现.html" class="active sidebar-link">数据结构与对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#跳跃表" class="sidebar-link">跳跃表</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#整数集合" class="sidebar-link">整数集合</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#压缩列表" class="sidebar-link">压缩列表</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#对象" class="sidebar-link">对象</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#数据库" class="sidebar-link">数据库</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#rdb持久化" class="sidebar-link">RDB持久化</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#aof持久化" class="sidebar-link">AOF持久化</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#文件事件" class="sidebar-link">文件事件</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#时间事件" class="sidebar-link">时间事件</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#重点-6" class="sidebar-link">重点</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#客户端" class="sidebar-link">客户端</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#服务器" class="sidebar-link">服务器</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#复制" class="sidebar-link">复制</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#sentinel" class="sidebar-link">Sentinel</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#集群" class="sidebar-link">集群</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#发布订阅" class="sidebar-link">发布订阅</a></li><li class="sidebar-sub-header"><a href="/数据库/redis设计与实现.html#事务" class="sidebar-link">事务</a></li></ul></li><li><a href="/数据库/MySQL的join原理.html" class="sidebar-link">/数据库/MySQL的join原理.html</a></li><li><a href="/数据库/MySQL性能优化.html" class="sidebar-link">/数据库/MySQL性能优化.html</a></li><li><a href="/数据库/MySQL总结.html" class="sidebar-link">MySQL总结</a></li><li><a href="/数据库/乐观锁和悲观锁.html" class="sidebar-link">乐观锁和悲观锁</a></li><li><a href="/数据库/redis(图灵学院).html" class="sidebar-link">什么是Redis</a></li><li><a href="/数据库/Redis总结.html" class="sidebar-link">Redis总结</a></li><li><a href="/数据库/Redis底层数据结构及其编码和优点.html" class="sidebar-link">Redis底层数据结构及其编码和优点</a></li><li><a href="/数据库/MySQL索引最佳实践.html" class="sidebar-link">/数据库/MySQL索引最佳实践.html</a></li><li><a href="/数据库/redis的事件.html" class="sidebar-link">Redis的事件</a></li><li><a href="/数据库/springboot使用h2数据库.html" class="sidebar-link">/数据库/springboot使用h2数据库.html</a></li><li><a href="/数据库/关于NoSQL.html" class="sidebar-link">NoSQL数据库的四大分类</a></li><li><a href="/数据库/布隆过滤器.html" class="sidebar-link">布隆过滤器</a></li><li><a href="/数据库/数据库基础和规范.html" class="sidebar-link">数据库建表规则（三大范式）</a></li><li><a href="/数据库/索引优化ORDER BY排序语句.html" class="sidebar-link">索引优化ORDER BY排序语句</a></li><li><a href="/数据库/覆盖索引，回表查询.html" class="sidebar-link">覆盖索引，回表查询</a></li><li><a href="/数据库/高性能MySQL.html" class="sidebar-link">MySQL架构与历史</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="数据结构与对象"><a href="#数据结构与对象" class="header-anchor">#</a> 数据结构与对象</h1> <h2 id="跳跃表"><a href="#跳跃表" class="header-anchor">#</a> 跳跃表</h2> <p>​		跳跃表是一种<strong>有序数据结构</strong>，通过每个节点中维持多个指向其它节点的指针，从而实现快速访问节点的目的。</p> <p>​		Redis使用跳跃表作为有序集合键的底层实现之一，如果一个<strong>有序集合包含的元素数量比较多，又或者有序集合中元素的成员是比较长的字符串时</strong>，Redis就会使用跳跃表来作为有序集合键的底层实现。</p> <h3 id="跳跃表实现"><a href="#跳跃表实现" class="header-anchor">#</a> 跳跃表实现</h3> <p>​		跳跃表由<code>zskiplistNode</code>和<code>zskiplist</code>两个结构定义，其中<code>zskiplistNode</code>标识跳跃表节点，<code>zskiplist</code>用于保存跳跃表节点的相关信息，比如<strong>节点数量，指向表头的指针和表尾节点的指针等</strong>。</p> <p><img src="F:%5CtyporaImg%5C1572239006090.png" alt="1572239006090"></p> <div class="language- extra-class"><pre><code>上图最左边的是`zskiplist`结构，包括一下属性
</code></pre></div><ul><li>header：指向跳跃表的<strong>表头节点</strong>。</li> <li>tail：指向跳跃表的<strong>表尾节点</strong>。</li> <li>level：记录目前跳跃表内，<strong>层数最大的那个节点的层数</strong>。</li> <li>length：记录跳跃表的长度，也就是<strong>跳跃表目前包含节点的数量</strong>。</li></ul> <p>​	位于<code>zskiplist</code>右边的结构是<code>zskiplistNode</code>，包括以下属性</p> <ul><li>层（level）节点中的L1，L2等，每个层都有两个属性：<strong>前进指针和跨度</strong>。前进指针用于访问位于表尾方向的其他节点，跨度则记录了前进指针所指向节点和当前节点的距离。（图中带数字的箭头就代表跨度，指向就代表前进指针）</li> <li>后退（backward）节点中用<code>BW</code>标记节点的后退指针，指向位于当前节点的前一个节点。<strong>表尾向表头遍历时使用</strong>。</li> <li>分值（score）1.0，2.0等，按<strong>从小到大排序</strong></li> <li>成员对象（obj）o1，o2等</li></ul> <h3 id="跳跃表节点"><a href="#跳跃表节点" class="header-anchor">#</a> 跳跃表节点</h3> <p><img src="F:%5CtyporaImg%5C1572239724191.png" alt="1572239724191"></p> <h3 id="跳跃表重点"><a href="#跳跃表重点" class="header-anchor">#</a> 跳跃表重点</h3> <ul><li>跳跃表是<strong>有序集合</strong>的底层实现之一。</li> <li>Redis的跳跃表实现由<code>zskiplist</code>和<code>azskiplistNode</code>两个结构组成，其中<code>zskiplist</code>用于保存跳跃表信息（比如表头节点、表尾节点、长度），而<code>zskiplistNode</code>用于表示跳跃表节点。</li> <li>每个跳跃表节点的层高都是<strong>1到32之间的随机数</strong>。</li> <li>同一跳跃表中，多个节点可以包含相同的分值，但<strong>每个节点的成员对象必须是唯一的</strong>。</li> <li>跳跃表中的节点按照分值大小排序，当分值相同时，节点按照成员对象的大小进行排序。</li></ul> <h2 id="整数集合"><a href="#整数集合" class="header-anchor">#</a> 整数集合</h2> <p>​		整数集合（intset）时集合键的底层实现之一，<strong>当一个集合只包含整数值元素，并且这个集合的元素数量不多</strong>时，Redis就会使用证书集合作为集合键的底层实现。</p> <h3 id="整数集合实现"><a href="#整数集合实现" class="header-anchor">#</a> 整数集合实现</h3> <p><img src="F:%5CtyporaImg%5C1572241241650.png" alt="1572241241650"></p> <p>​		<code>contents</code>数组的元素按从小到大有序排列，并且元素不重复。</p> <h3 id="升级"><a href="#升级" class="header-anchor">#</a> 升级</h3> <p>​		为整数集合添加元素时，需要先进行升级（upgrade），升级集合并且添加新元素分为三步进行：</p> <ul><li>根据新元素的类型，扩展集合空间，为新元素分配空间。</li> <li>将底层数组的所有元素类型都转换成新元素的类形，并将类型转换后的元素放到正确的位置上，并保持有序性不变。</li> <li>将新元素添加到底层数组里面。</li></ul> <p><img src="F:%5CtyporaImg%5C1572265936572.png" alt="1572265936572"></p> <p>​		升级的好处：提升整数集合的灵活性；尽可能地节约内存。</p> <p>​		整数集合不能降级，就算比较大的元素删除，也不能降级。</p> <h3 id="整数集合重点"><a href="#整数集合重点" class="header-anchor">#</a> 整数集合重点</h3> <ul><li>整数集合是集合键的底层实现之一</li> <li>整数集合底层实现是数组，这个数组以有序、无重复的方式保存集合元素，在有需要时，会根据新元素的类型来改变数组的类型</li> <li>升级提升了整数集合的灵活性；尽可能地节约内存，<strong>不支持降级</strong></li></ul> <h2 id="压缩列表"><a href="#压缩列表" class="header-anchor">#</a> 压缩列表</h2> <p>​		压缩列表（ziplist）是<strong>列表键和哈希键</strong>的底层实现之一。当一个<strong>列表键只包含少量列表项</strong>，并且每个列表项要么就是小整数值，要么就是长度比较短的字符串，那么Redis就会使用压缩列表来做列表键的底层实现。</p> <p><img src="F:%5CtyporaImg%5C1572313854406.png" alt="1572313854406"></p> <p><img src="F:%5CtyporaImg%5C1572313861381.png" alt="1572313861381"></p> <h3 id="压缩列表的构成"><a href="#压缩列表的构成" class="header-anchor">#</a> 压缩列表的构成</h3> <p>​		压缩列表是Redis为节约内存开发的。一个压缩列表包含任意多个节点（entry），<strong>每个节点可以保存一个字节数组或者一个整数值</strong>。</p> <p>​		压缩列表的组成部分如下图：</p> <p><img src="F:%5CtyporaImg%5C1572314108323.png" alt="1572314108323"></p> <p><img src="F:%5CtyporaImg%5C1572314016646.png" alt="1572314016646"></p> <p>​		压缩列表示例</p> <p><img src="F:%5CtyporaImg%5C1572314179766.png" alt="1572314179766"></p> <h3 id="压缩列表的节点构成"><a href="#压缩列表的节点构成" class="header-anchor">#</a> 压缩列表的节点构成</h3> <p>​		每个压缩列表的节点可以保存一个字节数组或者一个整数值，每个Entry的构成如下图</p> <p><img src="F:%5CtyporaImg%5C1572314328531.png" alt="1572314328531"></p> <ul><li><p>previous_entry_length: 记录了压缩列表中前一个节点的长度。（该属性的长度可以是1-5个字节）</p> <ul><li>如果前一个节点的长度<strong>小于</strong>254字节，那么previous_entry_length属性要用<strong>1字节</strong>长的空间来保存这个长度值</li> <li>如果前一个节点的长度<strong>大于等于</strong>254字节，那么previous_entry_length属性要用<strong>5字节</strong>长的空间来保存这个长度值</li></ul> <p><img src="F:%5CtyporaImg%5C1572314620905.png" alt="1572314620905"></p> <p><strong>因为当前节点记录了前一个节点的长度，所以可以根据当前节点的起始地址来计算出前一个节点的起始地址。</strong></p> <p>压缩列表从表尾向表头的遍历操作就是使用这一原理实现的。</p> <p><img src="F:%5CtyporaImg%5C1572314915429.png" alt="1572314915429"></p></li> <li><p>encoding：记录了节点的content属性所保存数据的类型以及长度</p></li> <li><p>content：保存节点的值</p></li></ul> <h3 id="连锁更新"><a href="#连锁更新" class="header-anchor">#</a> 连锁更新</h3> <p><img src="F:%5CtyporaImg%5C1572315284196.png" alt="1572315284196"></p> <p>​		e1的<code>previous_entry_length</code>只有一个字节，为了让e1能记录新节点的长度，则需要对e1进行扩展，让<code>previous_entry_length</code>扩展至5个字节。</p> <p>​		从而e1的扩展也引发了e2，以及后续节点的扩展。</p> <h3 id="重点"><a href="#重点" class="header-anchor">#</a> 重点</h3> <ul><li>压缩列表是一种为节约内存而开发的顺序性数据结构</li> <li>压缩列表被用作列表键和哈希键的底层实现之一。</li> <li>压缩列表可以包含多个节点， 每个节点可以保存一个字节数组或者一个整数值。</li> <li>添加新节点到压缩列表，或者从压缩列表中删除节点，可能会引发连锁更新。</li></ul> <h2 id="对象"><a href="#对象" class="header-anchor">#</a> 对象</h2> <p>​		Redis用到的所有主要数据结构，比如简单动态字符串（SDS）、双端链表、字典、压缩列表、整数集合等。</p> <p>​		Redis没有直接使用这些数据结构来实现键值对数据库，而是基于这些数据结构创建了一个对象系统，包含：<strong>字符串对象、列表对象、哈希对象、集合对象和有序集合对象</strong>，每个对象都用到了至少一种上面的数据结构。</p> <h3 id="对象的类型与编码"><a href="#对象的类型与编码" class="header-anchor">#</a> 对象的类型与编码</h3> <p>​		Redis在数据库中新创建一个键值对时，我们至少会创建两个对象，一个对象用作键，一个对象用作值。</p> <p><img src="F:%5CtyporaImg%5C1572316295839.png" alt="1572316295839"></p> <h4 id="类型"><a href="#类型" class="header-anchor">#</a> 类型</h4> <p><img src="F:%5CtyporaImg%5C1572316423487.png" alt="1572316423487"></p> <p><img src="F:%5CtyporaImg%5C1572316451258.png" alt="1572316451258"></p> <h4 id="编码和底层实现"><a href="#编码和底层实现" class="header-anchor">#</a> 编码和底层实现</h4> <p>​		对象的ptr指针指向对象的底层实现数据结构，而这些数据结构由对象的encoding属性决定。</p> <p>​		encoding属性记录了对象所使用的编码，也就是说这个对象使用了什么数据结构作为对象的底层实现。属性值对应下面代表中的常量</p> <p><img src="F:%5CtyporaImg%5C1572316739222.png" alt="1572316739222"></p> <p>​		每种类型的对象都至少使用了两种不同的编码，下表列出每种类型的对象可以使用的编码。</p> <p><img src="F:%5CtyporaImg%5C1572316871040.png" alt="1572316871040"></p> <p>​		使用<code>OBJECT ENCODING</code>命令可以查看一个数据库键的值对象的编码</p> <p><img src="F:%5CtyporaImg%5C1572316977765.png" alt="1572316977765"></p> <p><img src="F:%5CtyporaImg%5C1572316989578.png" alt="1572316989578"></p> <p>​		Redis可以根据不同场景来为一个对象设置不同的编码，从而优化对象在某场景下的效率：</p> <p><img src="F:%5CtyporaImg%5C1572317091580.png" alt="1572317091580"></p> <h3 id="字符串对象"><a href="#字符串对象" class="header-anchor">#</a> 字符串对象</h3> <p>​		字符串对象的编码可以是<strong>int、raw或者embstr</strong>；</p> <p><img src="F:%5CtyporaImg%5C1572317169117.png" alt="1572317169117"></p> <p><img src="F:%5CtyporaImg%5C1572317238650.png" alt="1572317238650"></p> <p>​		执行命令</p> <p><img src="F:%5CtyporaImg%5C1572317273146.png" alt="1572317273146"></p> <p><img src="F:%5CtyporaImg%5C1572317288676.png" alt="1572317288676"></p> <p><img src="F:%5CtyporaImg%5C1572317364854.png" alt="1572317364854"></p> <p><img src="F:%5CtyporaImg%5C1572317372803.png" alt="1572317372803"></p> <p>​		<strong>embstr编码的字符串对象来保存短字符串值的好处</strong></p> <p><img src="F:%5CtyporaImg%5C1572317461821.png" alt="1572317461821"></p> <p>​		执行命令</p> <p><img src="F:%5CtyporaImg%5C1572317506161.png" alt="1572317506161"></p> <p><img src="F:%5CtyporaImg%5C1572317512370.png" alt="1572317512370"></p> <h3 id="列表对象"><a href="#列表对象" class="header-anchor">#</a> 列表对象</h3> <p><img src="F:%5CtyporaImg%5C1572359001363.png" alt="1572359001363"></p> <p>若对象使用的是<code>ziplist</code>编码，那么这个键的值对象如下图：</p> <p><img src="F:%5CtyporaImg%5C1572359046917.png" alt="1572359046917"></p> <p><code>linkedlist</code>编码的列表对象使用了双端链表作为底层实现。每个双端链表节点（node）都保存了一个字符串对像，而每个字符串对象都保存了一个列表元素。</p> <p>键的值对象如下图：</p> <p><img src="F:%5CtyporaImg%5C1572359411376.png" alt="1572359411376"></p> <h4 id="编码转换"><a href="#编码转换" class="header-anchor">#</a> 编码转换</h4> <p>列表对象使用<code>ziplist</code>编码的两个条件：</p> <ul><li>列表对象保存的<strong>所有字符串元素的长度都小于64字节</strong>；</li> <li>列表对象保存的<strong>元素数量小于512个</strong>；不满足这两个条件的列表对象则使用<code>linkedlist</code>编码；</li></ul> <h3 id="哈希对象"><a href="#哈希对象" class="header-anchor">#</a> 哈希对象</h3> <p><img src="F:%5CtyporaImg%5C1572402719567.png" alt="1572402719567"></p> <p><img src="F:%5CtyporaImg%5C1572402728122.png" alt="1572402728122"></p> <p>执行命令</p> <p><img src="F:%5CtyporaImg%5C1572402912269.png" alt="1572402912269"></p> <p>​		<code>hashtable</code>编码的哈希对象使用<strong>字典</strong>作为底层实现，哈希对象中的<strong>每个键值对都使用一个字典键值对来保存</strong>：</p> <ul><li>字典的每个键都是一个字符串对象，对象中保存了键值对的键；</li> <li>字典的每个值都是一个字符串对象，对象中保存了键值对的值；</li></ul> <p><img src="F:%5CtyporaImg%5C1572403032532.png" alt="1572403032532"></p> <h4 id="编码转换-2"><a href="#编码转换-2" class="header-anchor">#</a> 编码转换</h4> <p>列表对象使用<code>ziplist</code>编码的两个条件：</p> <ul><li>列表对象保存的<strong>所有字符串元素的长度都小于64字节</strong>；</li> <li>列表对象保存的<strong>元素数量小于512个</strong>；不满足这两个条件的哈希对象则使用<code>hashtable</code>编码；</li></ul> <h3 id="集合对象"><a href="#集合对象" class="header-anchor">#</a> 集合对象</h3> <p><img src="F:%5CtyporaImg%5C1572403155250.png" alt="1572403155250"></p> <p><img src="F:%5CtyporaImg%5C1572403180263.png" alt="1572403180263"></p> <p><img src="F:%5CtyporaImg%5C1572403190660.png" alt="1572403190660"></p> <h4 id="编码转换-3"><a href="#编码转换-3" class="header-anchor">#</a> 编码转换</h4> <p>当集合对象同时满足以下两个条件时，对象使用<code>intset</code>编码；</p> <ul><li>集合对象保存的所有元素都是整数值；</li> <li>集合对象保存的元素数量不超过512个；</li></ul> <p>不满足这两个条件则要使用<code>hashtable</code>编码。</p> <h3 id="有序集合对象"><a href="#有序集合对象" class="header-anchor">#</a> 有序集合对象</h3> <p><img src="F:%5CtyporaImg%5C1572407304574.png" alt="1572407304574"></p> <p>执行代码</p> <p><img src="F:%5CtyporaImg%5C1572408103366.png" alt="1572408103366"></p> <p><img src="F:%5CtyporaImg%5C1572409206525.png" alt="1572409206525"></p> <p><img src="F:%5CtyporaImg%5C1572409320229.png" alt="1572409320229"></p> <p><img src="F:%5CtyporaImg%5C1572409591534.png" alt="1572409591534"></p> <p><strong>为什么有序集合要同时使用跳跃表和字典来实现</strong></p> <p><img src="F:%5CtyporaImg%5C1572409654843.png" alt="1572409654843"></p> <h4 id="编码转换-4"><a href="#编码转换-4" class="header-anchor">#</a> 编码转换</h4> <p>当有序集合对象同时满足以下两个条件时，对象使用<code>ziplist</code>编码；</p> <ul><li>有序集合保存的元素数量小于128个；</li> <li>有序集合保存的所有元素成员的长度都小于64字节；</li></ul> <p>不满足上面两个条件的有序集合对象将使用<code>skiplist</code>编码；</p> <h3 id="类型检查与命令多态"><a href="#类型检查与命令多态" class="header-anchor">#</a> 类型检查与命令多态</h3> <p><img src="F:%5CtyporaImg%5C1572487992863.png" alt="1572487992863"></p> <h4 id="类型检查的实现"><a href="#类型检查的实现" class="header-anchor">#</a> 类型检查的实现</h4> <p>​		在执行一个类型特定的命令之前，Redis会先检查输入键的类型是否正确，然后在决定是否执行该命令。</p> <p>​		类型特定命令进行的类型检查时通过<code>redisObject</code>结构的<code>type</code>属性来实现的。</p> <h4 id="多态命令的实现"><a href="#多态命令的实现" class="header-anchor">#</a> 多态命令的实现</h4> <p><img src="F:%5CtyporaImg%5C1572488216213.png" alt="1572488216213"></p> <h3 id="内存回收"><a href="#内存回收" class="header-anchor">#</a> 内存回收</h3> <p>​		Redis在对象系统中采用了引用计数的方式来跟踪每个对象的引用信息。从而对一些对象进行内存回收。</p> <p><img src="F:%5CtyporaImg%5C1572496599272.png" alt="1572496599272"></p> <h3 id="对象共享"><a href="#对象共享" class="header-anchor">#</a> 对象共享</h3> <p><img src="F:%5CtyporaImg%5C1572497062884.png" alt="1572497062884"></p> <p>可以使用<code>object refcount</code>命令来查看某个键的值对象的引用计数。</p> <h3 id="对象的空转时长"><a href="#对象的空转时长" class="header-anchor">#</a> 对象的空转时长</h3> <p><img src="F:%5CtyporaImg%5C1572498551986.png" alt="1572498551986"></p> <p>可以使用<code>object idletime</code>命令打印给定键的空转时长</p> <h3 id="重点-2"><a href="#重点-2" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572498734520.png" alt="1572498734520"></p> <h1 id="单机数据库的实现"><a href="#单机数据库的实现" class="header-anchor">#</a> 单机数据库的实现</h1> <h2 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h2> <p><img src="F:%5CtyporaImg%5C1572499269018.png" alt="1572499269018"></p> <p><img src="F:%5CtyporaImg%5C1572499286370.png" alt="1572499286370"></p> <h3 id="切换数据库"><a href="#切换数据库" class="header-anchor">#</a> 切换数据库</h3> <p><img src="F:%5CtyporaImg%5C1572499670742.png" alt="1572499670742"></p> <h3 id="设置键的生存时间或过期时间"><a href="#设置键的生存时间或过期时间" class="header-anchor">#</a> 设置键的生存时间或过期时间</h3> <p><img src="F:%5CtyporaImg%5C1572502743226.png" alt="1572502743226"></p> <p><img src="F:%5CtyporaImg%5C1572502931275.png" alt="1572502931275"></p> <p><img src="F:%5CtyporaImg%5C1572503073008.png" alt="1572503073008"></p> <p><img src="F:%5CtyporaImg%5C1572503103903.png" alt="1572503103903"></p> <h3 id="过期键删除策略"><a href="#过期键删除策略" class="header-anchor">#</a> 过期键删除策略</h3> <p><img src="F:%5CtyporaImg%5C1572518687978.png" alt="1572518687978"></p> <h4 id="定时删除"><a href="#定时删除" class="header-anchor">#</a> 定时删除</h4> <p>​		定时删除对内存时最友好的，但是对CPU是最不友好的。服务器创建大量的定时器，对CPU的消耗很大。可能对服务器的响应时间和吞吐量造成影响。</p> <p>​		此外，创建一个定时器要用Redis服务器中的时间事件，而时间事件的用<code>无序链表</code>来实现的，查找一个事件的时间复杂度为O（N）。比较低效。</p> <h4 id="惰性删除"><a href="#惰性删除" class="header-anchor">#</a> 惰性删除</h4> <p>​		惰性删除对CPU是最友好的，对内存是最不友好的，因为过期的键持续保存在内存中，只有等到下一次取出时才会释放。</p> <p>​		过多的过期键无法被删除，甚至可以看作这是一种内存泄漏。</p> <p><img src="F:%5CtyporaImg%5C1572519069530.png" alt="1572519069530"></p> <h4 id="定期删除"><a href="#定期删除" class="header-anchor">#</a> 定期删除</h4> <p><img src="F:%5CtyporaImg%5C1572519161676.png" alt="1572519161676"></p> <h3 id="重点-3"><a href="#重点-3" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572520345966.png" alt="1572520345966"></p> <p><img src="F:%5CtyporaImg%5C1572520358928.png" alt="1572520358928"></p> <h2 id="rdb持久化"><a href="#rdb持久化" class="header-anchor">#</a> RDB持久化</h2> <p>​		因为Redis是内存数据库，如果没有办法将内存中的数据存到磁盘，那么服务器一旦退出，服务器中的数据库状态也会消失不见。</p> <p>​		解决这个问题，需要使用Redis的RDB的持久化功能。</p> <p><img src="F:%5CtyporaImg%5C1572572978066.png" alt="1572572978066"></p> <h3 id="rbd文件的生成和载入"><a href="#rbd文件的生成和载入" class="header-anchor">#</a> RBD文件的生成和载入</h3> <p><img src="F:%5CtyporaImg%5C1572573069803.png" alt="1572573069803"></p> <p>Redis没有主动载入RDB文件的命令，只要Redis服务器启动时检测到RDB文件存在就会自动载入，RDB载入时，服务器会处于阻塞状态。</p> <p><img src="F:%5CtyporaImg%5C1572573141765.png" alt="1572573141765"></p> <h4 id="命令执行时的服务器状态"><a href="#命令执行时的服务器状态" class="header-anchor">#</a> 命令执行时的服务器状态</h4> <h5 id="执行save"><a href="#执行save" class="header-anchor">#</a> 执行save</h5> <p><img src="F:%5CtyporaImg%5C1572573386817.png" alt="1572573386817"></p> <h5 id="执行bgsave"><a href="#执行bgsave" class="header-anchor">#</a> 执行bgsave</h5> <p><img src="F:%5CtyporaImg%5C1572573412119.png" alt="1572573412119"></p> <p><img src="F:%5CtyporaImg%5C1572573479759.png" alt="1572573479759"></p> <h3 id="间隔性保存"><a href="#间隔性保存" class="header-anchor">#</a> 间隔性保存</h3> <p><img src="F:%5CtyporaImg%5C1572573563666.png" alt="1572573563666"></p> <h4 id="dirty计数器和lastsave属性"><a href="#dirty计数器和lastsave属性" class="header-anchor">#</a> dirty计数器和lastsave属性</h4> <p><img src="F:%5CtyporaImg%5C1572573707402.png" alt="1572573707402"></p> <h3 id="rdb文件结构"><a href="#rdb文件结构" class="header-anchor">#</a> RDB文件结构</h3> <p>​		<strong>RDB文件保存的是二进制数据。</strong></p> <p><img src="F:%5CtyporaImg%5C1572573919351.png" alt="1572573919351"></p> <p><img src="F:%5CtyporaImg%5C1572574050519.png" alt="1572574050519"></p> <p><img src="F:%5CtyporaImg%5C1572574080410.png" alt="1572574080410"></p> <p><img src="F:%5CtyporaImg%5C1572574163677.png" alt="1572574163677"></p> <h4 id="字符串对象-2"><a href="#字符串对象-2" class="header-anchor">#</a> 字符串对象</h4> <p><img src="F:%5CtyporaImg%5C1572575606389.png" alt="1572575606389"></p> <p><img src="F:%5CtyporaImg%5C1572575619783.png" alt="1572575619783"></p> <h4 id="列表对象-2"><a href="#列表对象-2" class="header-anchor">#</a> 列表对象</h4> <p><img src="F:%5CtyporaImg%5C1572575697343.png" alt="1572575697343"></p> <p><img src="F:%5CtyporaImg%5C1572575713218.png" alt="1572575713218"></p> <h4 id="集合对象-2"><a href="#集合对象-2" class="header-anchor">#</a> 集合对象</h4> <p><img src="F:%5CtyporaImg%5C1572575730353.png" alt="1572575730353"></p> <p><img src="F:%5CtyporaImg%5C1572575739734.png" alt="1572575739734"></p> <h4 id="哈希表对象"><a href="#哈希表对象" class="header-anchor">#</a> 哈希表对象</h4> <p><img src="F:%5CtyporaImg%5C1572575767125.png" alt="1572575767125"></p> <p><img src="F:%5CtyporaImg%5C1572575784527.png" alt="1572575784527"></p> <h4 id="有序集合对象-2"><a href="#有序集合对象-2" class="header-anchor">#</a> 有序集合对象</h4> <p><img src="F:%5CtyporaImg%5C1572575809608.png" alt="1572575809608"></p> <p><img src="F:%5CtyporaImg%5C1572575824983.png" alt="1572575824983"></p> <h3 id="重点-4"><a href="#重点-4" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572576142994.png" alt="1572576142994"></p> <h2 id="aof持久化"><a href="#aof持久化" class="header-anchor">#</a> AOF持久化</h2> <p>​		与RDB持久化通过<strong>保存数据库中的键值对</strong>来记录数据库状态不同，AOF持久化是通过<strong>保存Redis服务器所执行的写命令</strong>来记录数据库状态的。</p> <p><img src="F:%5CtyporaImg%5C1572576312974.png" alt="1572576312974"></p> <h3 id="aof文件的载入与数据还原"><a href="#aof文件的载入与数据还原" class="header-anchor">#</a> AOF文件的载入与数据还原</h3> <p><img src="F:%5CtyporaImg%5C1572581504833.png" alt="1572581504833"></p> <h3 id="aof重写"><a href="#aof重写" class="header-anchor">#</a> AOF重写</h3> <p><img src="F:%5CtyporaImg%5C1572581578352.png" alt="1572581578352"></p> <h4 id="aof重写原理"><a href="#aof重写原理" class="header-anchor">#</a> AOF重写原理</h4> <p>​		通过读取某个键的值来保存一条Redis语句来记录键值对，代替之前记录这个键值对的多个命令，而不是保存多条关于该键的值操作语句。</p> <p><img src="F:%5CtyporaImg%5C1572581809572.png" alt="1572581809572"></p> <h4 id="aof后台重写"><a href="#aof后台重写" class="header-anchor">#</a> AOF后台重写</h4> <p>​		AOF重写程序会进行大量的写操作，导致调用这个函数的线程被长时间阻塞，因为Redis服务器使用单个线程来处理命令请求，所以在重写AOF文件期间，Redis将无法处理客户端的其它命令请求。</p> <p><img src="F:%5CtyporaImg%5C1572582028316.png" alt="1572582028316"></p> <h3 id="重点-5"><a href="#重点-5" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572582181870.png" alt="1572582181870"></p> <h2 id="文件事件"><a href="#文件事件" class="header-anchor">#</a> 文件事件</h2> <p><img src="F:%5CtyporaImg%5C1572584219398.png" alt="1572584219398"></p> <p><img src="F:%5CtyporaImg%5C1572659440383.png" alt="1572659440383"></p> <h2 id="时间事件"><a href="#时间事件" class="header-anchor">#</a> 时间事件</h2> <p><img src="F:%5CtyporaImg%5C1572659507793.png" alt="1572659507793"></p> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <p><img src="F:%5CtyporaImg%5C1572659556702.png" alt="1572659556702"></p> <h2 id="重点-6"><a href="#重点-6" class="header-anchor">#</a> 重点</h2> <p><img src="F:%5CtyporaImg%5C1572659719431.png" alt="1572659719431"></p> <h2 id="客户端"><a href="#客户端" class="header-anchor">#</a> 客户端</h2> <p><img src="F:%5CtyporaImg%5C1572659866002.png" alt="1572659866002"></p> <p>​		Redis<strong>服务器状态结构的clients</strong>属性是一个链表，这个链表保存了所有与服务器连接的客户端的状态结构，对客户端执行批量操作，或查找某个客户端。都可以通过遍历clients链表来完成。</p> <h3 id="重点-7"><a href="#重点-7" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572660697182.png" alt="1572660697182"></p> <p><img src="F:%5CtyporaImg%5C1572660712062.png" alt="1572660712062"></p> <h2 id="服务器"><a href="#服务器" class="header-anchor">#</a> 服务器</h2> <h3 id="命令执行过程"><a href="#命令执行过程" class="header-anchor">#</a> 命令执行过程</h3> <p><img src="F:%5CtyporaImg%5C1572660837782.png" alt="1572660837782"></p> <h3 id="servercron函数"><a href="#servercron函数" class="header-anchor">#</a> serverCron函数</h3> <p><img src="F:%5CtyporaImg%5C1572661396021.png" alt="1572661396021"></p> <h4 id="更新服务器时间缓存"><a href="#更新服务器时间缓存" class="header-anchor">#</a> 更新服务器时间缓存<img src="F:%5CtyporaImg%5C1572661498731.png" alt="1572661498731"></h4> <h4 id="更新lru时钟"><a href="#更新lru时钟" class="header-anchor">#</a> 更新LRU时钟</h4> <p>​		也是服务器时间缓存的一种，每个<code>Redis</code>对象都会有一个<code>lru</code>属性，这个属性保存了<strong>对象最后一次被命令访问的时间</strong>.</p> <h4 id="更新服务器每秒执行命令的次数"><a href="#更新服务器每秒执行命令的次数" class="header-anchor">#</a> 更新服务器每秒执行命令的次数</h4> <p><img src="F:%5CtyporaImg%5C1572661719175.png" alt="1572661719175"></p> <h4 id="更新服务器内存峰值记录"><a href="#更新服务器内存峰值记录" class="header-anchor">#</a> 更新服务器内存峰值记录</h4> <p><img src="F:%5CtyporaImg%5C1572661786280.png" alt="1572661786280"></p> <h4 id="处理sigterm信号"><a href="#处理sigterm信号" class="header-anchor">#</a> 处理sigterm信号<img src="F:%5CtyporaImg%5C1572661850163.png" alt="1572661850163"></h4> <p>​		当<code>serverCron</code>函数执行的时候,会检查服务器状态的<code>shutdown_asap</code>属性,并根据属性的值决定是否关闭服务器.</p> <h4 id="管理客户端资源"><a href="#管理客户端资源" class="header-anchor">#</a> 管理客户端资源</h4> <p><img src="F:%5CtyporaImg%5C1572661942160.png" alt="1572661942160"></p> <h4 id="管理数据库资源"><a href="#管理数据库资源" class="header-anchor">#</a> 管理数据库资源</h4> <p>​		删除过期键,并在有需要时,对字典进行收缩操作.</p> <h4 id="执行被延迟的bgrewriteaof"><a href="#执行被延迟的bgrewriteaof" class="header-anchor">#</a> 执行被延迟的BGREWRITEAOF</h4> <p><img src="F:%5CtyporaImg%5C1572662015874.png" alt="1572662015874"></p> <p>​		当<code>serverCron</code>函数执行的时候,会检查<code>BGSAVE</code>命令或者<code>BGREWRITEAOF</code>命令是否正在执行,如果这两个命令都没在执行,并且<code>aof_rewrite_scheduled</code>属性的值为<strong>1</strong>,那么服务器就会执行之前被推延的<code>BGREWRITEAOF</code>命令.</p> <h4 id="查看持久化操作的运行状态"><a href="#查看持久化操作的运行状态" class="header-anchor">#</a> 查看持久化操作的运行状态</h4> <p><img src="F:%5CtyporaImg%5C1572662677562.png" alt="1572662677562"></p> <h3 id="初始化服务器"><a href="#初始化服务器" class="header-anchor">#</a> 初始化服务器</h3> <p>​		初始化server的工作由<code>initServerConfig</code>函数完成.</p> <p><img src="F:%5CtyporaImg%5C1572668980443.png" alt="1572668980443"></p> <p><img src="F:%5CtyporaImg%5C1572668985780.png" alt="1572668985780"></p> <h3 id="重点-8"><a href="#重点-8" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572669236443.png" alt="1572669236443"></p> <h1 id="多机数据库的实现"><a href="#多机数据库的实现" class="header-anchor">#</a> 多机数据库的实现</h1> <h2 id="复制"><a href="#复制" class="header-anchor">#</a> 复制</h2> <p><img src="F:%5CtyporaImg%5C1572669337016.png" alt="1572669337016"></p> <p><img src="F:%5CtyporaImg%5C1572669360025.png" alt="1572669360025"></p> <h3 id="旧版复制"><a href="#旧版复制" class="header-anchor">#</a> 旧版复制</h3> <p><img src="F:%5CtyporaImg%5C1572669698978.png" alt="1572669698978"></p> <p><img src="F:%5CtyporaImg%5C1572669754550.png" alt="1572669754550"></p> <h4 id="主从服务器同步过程"><a href="#主从服务器同步过程" class="header-anchor">#</a> 主从服务器同步过程</h4> <p><img src="F:%5CtyporaImg%5C1572758938525.png" alt="1572758938525"></p> <h4 id="旧版同步的缺陷"><a href="#旧版同步的缺陷" class="header-anchor">#</a> 旧版同步的缺陷</h4> <p><img src="F:%5CtyporaImg%5C1572759240640.png" alt="1572759240640"></p> <p><img src="F:%5CtyporaImg%5C1572767985491.png" alt="1572767985491"></p> <h3 id="新版复制"><a href="#新版复制" class="header-anchor">#</a> 新版复制</h3> <p>​		解决了旧版复制功能在断线后重复制效率低下的问题</p> <p><img src="F:%5CtyporaImg%5C1572768073578.png" alt="1572768073578"></p> <h3 id="复制的实现"><a href="#复制的实现" class="header-anchor">#</a> 复制的实现</h3> <ul><li>设置主服务器的地址和端口</li> <li>建立套接字连接</li> <li>发送ping命令</li> <li>身份验证</li> <li>发送从服务器端口信息（监听端口号）</li> <li>同步</li> <li>命令广播</li></ul> <h3 id="重点-9"><a href="#重点-9" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572768999135.png" alt="1572768999135"></p> <h2 id="sentinel"><a href="#sentinel" class="header-anchor">#</a> Sentinel</h2> <p><img src="F:%5CtyporaImg%5C1572833650451.png" alt="1572833650451"></p> <p><img src="F:%5CtyporaImg%5C1572833663329.png" alt="1572833663329"></p> <p><img src="F:%5CtyporaImg%5C1572833673711.png" alt="1572833673711"></p> <h2 id="集群"><a href="#集群" class="header-anchor">#</a> 集群</h2> <p>​		Redis集群是Redis提供的分布式数据库方案，集群通过分片（sharding）来进行数据共享，并提供复制和故障转移功能。</p> <h3 id="节点"><a href="#节点" class="header-anchor">#</a> 节点</h3> <p><img src="F:%5CtyporaImg%5C1572833865990.png" alt="1572833865990"></p> <h4 id="启动节点"><a href="#启动节点" class="header-anchor">#</a> 启动节点</h4> <p><img src="F:%5CtyporaImg%5C1572834133480.png" alt="1572834133480"></p> <h4 id="集群数据结构"><a href="#集群数据结构" class="header-anchor">#</a> 集群数据结构</h4> <p><img src="F:%5CtyporaImg%5C1572834524269.png" alt="1572834524269"></p> <p><img src="F:%5CtyporaImg%5C1572834568405.png" alt="1572834568405"></p> <h3 id="槽指派"><a href="#槽指派" class="header-anchor">#</a> 槽指派</h3> <p><img src="F:%5CtyporaImg%5C1572834654948.png" alt="1572834654948"></p> <p><img src="F:%5CtyporaImg%5C1572834737207.png" alt="1572834737207"></p> <p>​		如果客户端发送命令对应键的槽不属于当前的服务器（节点），那么服务器会返回MOVED错误给客户端，并携带正确的槽所属服务器的地址和端口，让客户端重新执行命令。</p> <h3 id="重点-10"><a href="#重点-10" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572922608951.png" alt="1572922608951"></p> <h2 id="发布订阅"><a href="#发布订阅" class="header-anchor">#</a> 发布订阅</h2> <p><img src="F:%5CtyporaImg%5C1572921143198.png" alt="1572921143198"></p> <p>​		还支持相匹配的模式的订阅，执行<code>subscribe news.[ie]t</code></p> <p><img src="F:%5CtyporaImg%5C1572921214917.png" alt="1572921214917"></p> <h3 id="频道的订阅与退订"><a href="#频道的订阅与退订" class="header-anchor">#</a> 频道的订阅与退订</h3> <p>pubsub_channels字典中记录了被订阅频道和订阅客户端的信息（链表）。</p> <p><img src="F:%5CtyporaImg%5C1572921363177.png" alt="1572921363177"></p> <p>退订使用命令<code>UNSUBSCTIBE</code></p> <h3 id="模式的订阅与退订"><a href="#模式的订阅与退订" class="header-anchor">#</a> 模式的订阅与退订</h3> <p><img src="F:%5CtyporaImg%5C1572921715855.png" alt="1572921715855"></p> <p><img src="F:%5CtyporaImg%5C1572921740978.png" alt="1572921740978"></p> <ul><li><p>订阅使用命令<code>PSUBSCRIBE</code></p></li> <li><p>退订使用命令<code>PUNSUBSCRIBE</code></p></li></ul> <h3 id="发送消息"><a href="#发送消息" class="header-anchor">#</a> 发送消息</h3> <p><img src="F:%5CtyporaImg%5C1572921951290.png" alt="1572921951290"></p> <h3 id="查看订阅信息"><a href="#查看订阅信息" class="header-anchor">#</a> 查看订阅信息</h3> <ul><li>pubsub channels</li></ul> <p><img src="F:%5CtyporaImg%5C1572922067543.png" alt="1572922067543"></p> <ul><li><p>pubsub numsub</p> <p><img src="F:%5CtyporaImg%5C1572922212151.png" alt="1572922212151"></p> <p><img src="F:%5CtyporaImg%5C1572922232907.png" alt="1572922232907"></p></li> <li><p>pubsub numpat</p> <p><img src="F:%5CtyporaImg%5C1572922538860.png" alt="1572922538860"></p></li></ul> <h3 id="重点-11"><a href="#重点-11" class="header-anchor">#</a> 重点</h3> <p><img src="F:%5CtyporaImg%5C1572922579721.png" alt="1572922579721"></p> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <p><img src="F:%5CtyporaImg%5C1572922913573.png" alt="1572922913573"></p> <h3 id="事务开始"><a href="#事务开始" class="header-anchor">#</a> 事务开始</h3> <p><img src="F:%5CtyporaImg%5C1572922948755.png" alt="1572922948755"></p> <h3 id="执行事务"><a href="#执行事务" class="header-anchor">#</a> 执行事务</h3> <p><img src="F:%5CtyporaImg%5C1572925730807.png" alt="1572925730807"></p> <h3 id="watch命令的实现"><a href="#watch命令的实现" class="header-anchor">#</a> WATCH命令的实现</h3> <p><img src="F:%5CtyporaImg%5C1572925804332.png" alt="1572925804332"></p> <p><img src="F:%5CtyporaImg%5C1572925847048.png" alt="1572925847048"></p> <h3 id="事务的acid性质"><a href="#事务的acid性质" class="header-anchor">#</a> 事务的ACID性质</h3> <h3 id=""><a href="#" class="header-anchor">#</a> <img src="F:%5CtyporaImg%5C1572926013518.png" alt="1572926013518"></h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/数据库/MongoDB权威指南.html" class="prev">
        MongoDB权威指南
      </a></span> <span class="next"><a href="/数据库/MySQL的join原理.html">
        /数据库/MySQL的join原理.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1b94221b.js" defer></script><script src="/assets/js/2.60568d92.js" defer></script><script src="/assets/js/30.a98a6693.js" defer></script>
  </body>
</html>
