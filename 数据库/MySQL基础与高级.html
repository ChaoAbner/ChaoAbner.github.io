<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础 | 文档测试</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Curriculum Vitae">
    <link rel="preload" href="/assets/css/0.styles.40e1e164.css" as="style"><link rel="preload" href="/assets/js/app.1b94221b.js" as="script"><link rel="preload" href="/assets/js/2.60568d92.js" as="script"><link rel="preload" href="/assets/js/19.638c9ba4.js" as="script"><link rel="prefetch" href="/assets/js/10.3d4294c4.js"><link rel="prefetch" href="/assets/js/11.14a477ac.js"><link rel="prefetch" href="/assets/js/12.a5ddb7e5.js"><link rel="prefetch" href="/assets/js/13.aae5c909.js"><link rel="prefetch" href="/assets/js/14.ab694e76.js"><link rel="prefetch" href="/assets/js/15.64315535.js"><link rel="prefetch" href="/assets/js/16.73da9ac4.js"><link rel="prefetch" href="/assets/js/17.a93d8ff3.js"><link rel="prefetch" href="/assets/js/18.b4ced15b.js"><link rel="prefetch" href="/assets/js/20.b2eb7bf9.js"><link rel="prefetch" href="/assets/js/21.48394f3a.js"><link rel="prefetch" href="/assets/js/22.35e8a3cc.js"><link rel="prefetch" href="/assets/js/23.552730b3.js"><link rel="prefetch" href="/assets/js/24.e9135eeb.js"><link rel="prefetch" href="/assets/js/25.81b2ea1d.js"><link rel="prefetch" href="/assets/js/26.75302b23.js"><link rel="prefetch" href="/assets/js/27.9e876760.js"><link rel="prefetch" href="/assets/js/28.57922220.js"><link rel="prefetch" href="/assets/js/29.68fbb04d.js"><link rel="prefetch" href="/assets/js/3.fe45d089.js"><link rel="prefetch" href="/assets/js/30.a98a6693.js"><link rel="prefetch" href="/assets/js/31.8202c39f.js"><link rel="prefetch" href="/assets/js/32.febfda4f.js"><link rel="prefetch" href="/assets/js/33.5ae3ee39.js"><link rel="prefetch" href="/assets/js/34.15947107.js"><link rel="prefetch" href="/assets/js/35.d3f8c53a.js"><link rel="prefetch" href="/assets/js/36.b7fee681.js"><link rel="prefetch" href="/assets/js/37.c13c8f17.js"><link rel="prefetch" href="/assets/js/38.793a8df9.js"><link rel="prefetch" href="/assets/js/4.4d86075a.js"><link rel="prefetch" href="/assets/js/5.d5b9441a.js"><link rel="prefetch" href="/assets/js/6.19d672a5.js"><link rel="prefetch" href="/assets/js/7.5f6998cb.js"><link rel="prefetch" href="/assets/js/8.f35ecf57.js"><link rel="prefetch" href="/assets/js/9.99850ec9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.40e1e164.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档测试</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/数据库/redis的原子性.html" class="sidebar-link">redis的原子性</a></li><li><a href="/数据库/MongoDB总结.html" class="sidebar-link">MongoDB总结</a></li><li><a href="/数据库/redis的数据库.html" class="sidebar-link">redis的数据库</a></li><li><a href="/数据库/MySQL基础与高级.html" class="active sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/数据库/MySQL基础与高级.html#基础" class="sidebar-link">基础</a></li><li class="sidebar-sub-header"><a href="/数据库/MySQL基础与高级.html#高级" class="sidebar-link">高级</a></li></ul></li><li><a href="/数据库/MongoDB权威指南.html" class="sidebar-link">MongoDB权威指南</a></li><li><a href="/数据库/redis设计与实现.html" class="sidebar-link">数据结构与对象</a></li><li><a href="/数据库/MySQL的join原理.html" class="sidebar-link">/数据库/MySQL的join原理.html</a></li><li><a href="/数据库/MySQL性能优化.html" class="sidebar-link">/数据库/MySQL性能优化.html</a></li><li><a href="/数据库/MySQL总结.html" class="sidebar-link">MySQL总结</a></li><li><a href="/数据库/乐观锁和悲观锁.html" class="sidebar-link">乐观锁和悲观锁</a></li><li><a href="/数据库/redis(图灵学院).html" class="sidebar-link">什么是Redis</a></li><li><a href="/数据库/Redis总结.html" class="sidebar-link">Redis总结</a></li><li><a href="/数据库/Redis底层数据结构及其编码和优点.html" class="sidebar-link">Redis底层数据结构及其编码和优点</a></li><li><a href="/数据库/MySQL索引最佳实践.html" class="sidebar-link">/数据库/MySQL索引最佳实践.html</a></li><li><a href="/数据库/redis的事件.html" class="sidebar-link">Redis的事件</a></li><li><a href="/数据库/springboot使用h2数据库.html" class="sidebar-link">/数据库/springboot使用h2数据库.html</a></li><li><a href="/数据库/关于NoSQL.html" class="sidebar-link">NoSQL数据库的四大分类</a></li><li><a href="/数据库/布隆过滤器.html" class="sidebar-link">布隆过滤器</a></li><li><a href="/数据库/数据库基础和规范.html" class="sidebar-link">数据库建表规则（三大范式）</a></li><li><a href="/数据库/索引优化ORDER BY排序语句.html" class="sidebar-link">索引优化ORDER BY排序语句</a></li><li><a href="/数据库/覆盖索引，回表查询.html" class="sidebar-link">覆盖索引，回表查询</a></li><li><a href="/数据库/高性能MySQL.html" class="sidebar-link">MySQL架构与历史</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <h3 id="去重"><a href="#去重" class="header-anchor">#</a> 去重</h3> <p>加上关键字 distinct，后面再加上字段名</p> <p><code>select distinct name from role;</code></p> <h3 id="号"><a href="#号" class="header-anchor">#</a> <strong>+号</strong></h3> <p>MySQL中的加号只有运算符的功能</p> <h3 id="concat"><a href="#concat" class="header-anchor">#</a> <strong>concat</strong></h3> <p>将多个字段连接成一个字段来显示</p> <p><code>select concat(first_name, last_name) as name from user;</code></p> <p>结果将<strong>first_name</strong>和<strong>last_name</strong>合成一个name字段来显示</p> <p>也可用分隔符分隔，如用<code>-</code>分隔</p> <p><code>select concat(first_name, '-', last_name) as name from user;</code></p> <p>当传入concat中的字段可能存在有null值的时候，连接的结果显示会全部为null。这时可以用函数<code>IFNULL</code>来处理。</p> <p>比如<strong>last_name</strong>可能有null值，如果有null值，则替换成0。</p> <p><code>select concat(first_name, '-', IFNULL(last_name，0)) as name from user;</code></p> <h3 id="条件查询"><a href="#条件查询" class="header-anchor">#</a> <strong>条件查询</strong></h3> <p><code>select 查询列表 from 表名 where 筛选条件；</code></p> <p>分类：</p> <ol><li><p>条件表达式筛选</p> <p><strong>&lt;, &gt;, =, !=, &gt;=, &lt;=</strong></p></li> <li><p>按逻辑表达式筛选（用于连接条件表达式）</p> <p><strong>&amp;&amp;, ||, !, and, or, not</strong></p></li> <li><p>模糊查询</p> <p><strong>like, between and, in, is null</strong></p> <p><code>%</code>匹配任意多的字符，<code>_</code>作为通配符匹配一个字符</p> <p><code>select * from user where name like '%n%';</code> (查找name字段中间含有字母n的所有数据)</p> <p><code>select * from user where name like '_n%';</code> (查找name字段第二个字母为n的所有数据)</p> <p>如果<code>'_n%'</code>中想单纯匹配下划线，那么可以使用转移字符<code>\</code></p></li></ol> <h4 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h4> <p>1、<strong>between and</strong></p> <p><code>select name, age from user where age &lt; 60 and age &gt; 20;</code></p> <p>此时可以使用<strong>between and</strong> 来代替&lt; &gt;同一个字段的情况。</p> <p><code>select name, age from user where between 20 and 60;</code></p> <p>2、<strong>in</strong>(取出符合范围中的所有值， in中不支持通配符)</p> <p><code>select name, id from user where age = 18 or age = 20 or age = 24;</code></p> <p>使用in</p> <p><code>select name, age from user where age in(18, 20, 24);</code></p> <h3 id="排序"><a href="#排序" class="header-anchor">#</a> 排序</h3> <p>使用order by关键字, [asc （升序）| desc（降序）]</p> <p><code>select * form user order by create_time desc;</code></p> <p>只有<strong>limit</strong>放在order by 的后面，其它都放在order by的前面。</p> <p><strong>练习</strong></p> <p><img src="F:%5CtyporaImg%5C1579404038994.png" alt="1579404038994"></p> <h3 id="常用函数"><a href="#常用函数" class="header-anchor">#</a> 常用函数</h3> <ul><li><p>单行函数</p> <ul><li><p>字符函数</p> <p>concat () 	length()	substr() 	upper() 	lower() 	ifnull()	trim()去前后空格  等</p></li> <li><p>数学函数</p> <p>round(num, bit) 四舍五入,bit用来指定保留位数	ceil() 向上去取整 	floor() 向下取整 	truncate() 截断，保留一位</p> <p>mod() 取余</p></li> <li><p>时间函数</p> <p>now() 返回当前的系统日期+时间 	curdate() 返回当前系统日期</p> <p>curtime() 返回当前时间	year() 传入时间参数，取出年份	month() 取出月份</p> <p>str_to_date(str, format) 将str根据format格式转成时间形式</p> <p>date_format(date, format) 将date根据format格式转成字符串形式</p> <p>format格式如下图</p> <p><img src="F:%5CtyporaImg%5C1579412867351.png" alt="1579412867351"></p></li> <li><p>其它函数</p></li></ul></li> <li><p>组合函数（做统计使用，又称为统计函数、聚合函数、函数）</p> <p>sum 求和、avg 平均值（处理数值型，忽略null值）</p> <p>max 最大值、 min最小值、count 计算个数（处理任何类型）</p> <p>count(*) 用于统计数据总行数</p> <p>类似于count(1)的意思是另外加一列全为1的列，再统计这列的行数，也是相当于统计数据的总行数。当然count(2)也行。</p></li></ul> <h3 id="分组查询"><a href="#分组查询" class="header-anchor">#</a> 分组查询</h3> <p>group by(field)  根据field先分组，在对每个组来进行查询等操作。</p> <p><img src="F:%5CtyporaImg%5C1579415803111.png" alt="1579415803111"></p> <h3 id="连接查询"><a href="#连接查询" class="header-anchor">#</a> 连接查询</h3> <p>又称多表查询，联合多个表来查询</p> <p>分类：</p> <ul><li><p>按年代分类：</p> <ul><li>sql192标准 	仅支持内连接</li> <li>sql199标准【推荐】   支持内连接，外连接（左外，右外）交叉连接</li></ul></li> <li><p>按功能分类：</p> <ul><li><p>内连接：</p> <p>等值连接</p> <p><img src="F:%5CtyporaImg%5C1579418590285.png" alt="1579418590285"></p> <p>非等值连接	（也是多表查询，连接条件不为等值）</p> <p>自连接（单表查询）</p> <p><img src="F:%5CtyporaImg%5C1579418942987.png" alt="1579418942987"></p></li> <li><p>外连接：</p> <p>左外连接	右外连接	全外连接</p></li> <li><p>交叉连接：</p></li></ul></li></ul> <p><strong>语法</strong></p> <p><img src="F:%5CtyporaImg%5C1579483895621.png" alt="1579483895621"></p> <h3 id="子查询"><a href="#子查询" class="header-anchor">#</a> 子查询</h3> <p>select内部嵌套其它select语句的查询，外部的select称为外查询或主查询，内部的select称为内查询或子查询。其实内查询的结果作为一个集合给外查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> name <span class="token keyword">from</span> <span class="token keyword">user</span>
<span class="token keyword">where</span> group_id <span class="token operator">in</span> 
<span class="token punctuation">(</span><span class="token keyword">select</span> group_id <span class="token keyword">from</span> <span class="token keyword">group</span> <span class="token keyword">where</span> location_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="联合查询"><a href="#联合查询" class="header-anchor">#</a> 联合查询</h3> <p>union。连接多个表的结果集，合并成一个结果。</p> <p>应用场景一般是，查询多个表，表之间没有什么直接联系，但是查询的字段一致。</p> <p><strong>特点</strong></p> <ul><li>多表查询的列数要求一致</li> <li>多表查询的列数的类型和顺序最好一致</li> <li>union关键字默认去重，如果使用union all则包含重复项。</li></ul> <p><strong>语法</strong>：</p> <p><code>select .. from ...</code></p> <p><code>union...</code></p> <p><code>union...</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 单表联合查询</span>
<span class="token keyword">select</span> name <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">18</span> <span class="token operator">or</span> gender <span class="token operator">=</span> <span class="token string">'male'</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> name <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">18</span> 
<span class="token keyword">union</span>
<span class="token keyword">select</span> name <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token string">'male'</span><span class="token punctuation">;</span>

<span class="token comment"># 多表联合查询</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span> gender <span class="token keyword">from</span> cn_people <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token string">'male'</span>
<span class="token keyword">union</span> 
<span class="token keyword">select</span> name<span class="token punctuation">,</span> gender <span class="token keyword">from</span> us_people <span class="token keyword">where</span> gender <span class="token operator">=</span> <span class="token string">'male'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="约束"><a href="#约束" class="header-anchor">#</a> 约束</h3> <p>限制表中的数据，保证表中数据的可靠性和准确性。</p> <ul><li>NOT NULL： 不为空</li> <li>DEFAULT： 默认，保证字段有默认值</li> <li>PRIMARY KEY： 主键，保证该字段的唯一性，非空。</li> <li>UNIQUE： 唯一，用于保证字段的值有唯一性，可以为空。</li> <li>CHECK： 检查约束，【MySQL不支持】</li> <li>FOREIGN KEY：外键，该字段的值来自另外的表的关联列的值。</li></ul> <h3 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h3> <p>###<strong>含义</strong>
通过一组逻辑操作单元（一组DML——sql语句），将数据从一种状态切换到另外一种状态</p> <p>###<strong>特点</strong>
（ACID）
原子性：要么都执行，要么都回滚
一致性：保证数据的状态操作前和操作后保持一致
隔离性：多个事务同时操作相同数据库的同一个数据时，一个事务的执行不受另外一个事务的干扰
持久性：一个事务一旦提交，则数据将持久化到本地，除非其他事务对其进行修改</p> <p><strong>相关步骤</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、开启事务
2、编写事务的一组逻辑操作单元（多条sql语句）
3、提交事务或回滚事务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="事务的分类："><a href="#事务的分类：" class="header-anchor">#</a> 事务的分类：</h4> <p><strong>隐式事务</strong>，没有明显的开启和结束事务的标志</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>比如
insert、update、delete语句本身就是一个事务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>显式事务</strong>，具有明显的开启和结束事务的标志</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、开启事务
取消自动提交事务的功能

2、编写事务的一组逻辑操作单元（多条sql语句）
insert
update
delete

3、提交事务或回滚事务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>使用到的关键字</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>set autocommit=0;
start transaction;
commit;
rollback;

savepoint  断点
commit to 断点
rollback to 断点
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="事务的隔离级别"><a href="#事务的隔离级别" class="header-anchor">#</a> 事务的隔离级别:</h4> <p><strong>事务并发问题如何发生</strong>？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>当多个事务同时操作同一个数据库的相同数据时
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>事务的并发问题有哪些</strong>？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>脏读：一个事务读取到了另外一个事务未提交的数据
不可重复读：同一个事务中，多次读取到的数据不一致
幻读：一个事务读取数据时，另外一个事务进行更新，导致第一个事务读取到了没有更新的数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>如何避免事务的并发问题</strong>？</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>通过设置事务的隔离级别
1、READ UNCOMMITTED
2、READ COMMITTED 可以避免脏读
3、REPEATABLE READ 可以避免脏读、不可重复读和一部分幻读
4、SERIALIZABLE可以避免脏读、不可重复读和幻读
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>设置隔离级别</strong>：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> <span class="token keyword">session</span><span class="token operator">|</span><span class="token keyword">global</span>  <span class="token keyword">transaction</span> <span class="token keyword">isolation</span> <span class="token keyword">level</span> 隔离级别名<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>查看隔离级别</strong>：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@transaction_isolation</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="事务acid属性"><a href="#事务acid属性" class="header-anchor">#</a> 事务ACID属性</h4> <p><img src="F:%5CtyporaImg%5C1579685169412.png" alt="1579685169412"></p> <h2 id="高级"><a href="#高级" class="header-anchor">#</a> 高级</h2> <h3 id="mysql逻辑架构"><a href="#mysql逻辑架构" class="header-anchor">#</a> MySQL逻辑架构</h3> <ul><li><p>连接层</p> <p>客户端等连接服务，完成一些安全认证，授权等操作。引入了<strong>连接池</strong>的概念.</p></li> <li><p>服务层</p> <p>完成核心服务，SQL操作、分析、优化等，以及缓存的查询。内置函数的执行。</p></li> <li><p>引擎层</p> <p>存储引擎层，负责MySQL真正的数据存储和提取。常见<strong>InnoDB</strong>和<strong>MyISAM</strong></p></li> <li><p>存储层</p> <p>文件系统，硬盘。</p></li></ul> <h3 id="存储引擎"><a href="#存储引擎" class="header-anchor">#</a> 存储引擎</h3> <p>查看当前存储引擎</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&quot;storage_engine&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看数据库支持的存储引擎</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> engines<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="F:%5CtyporaImg%5C1579569457692.png" alt="1579569457692"></p> <h4 id="myisam和innodb"><a href="#myisam和innodb" class="header-anchor">#</a> MyISAM和InnoDB</h4> <p><strong><img src="F:%5CtyporaImg%5C1579569591884.png" alt="1579569591884"></strong></p> <h3 id="查询变慢"><a href="#查询变慢" class="header-anchor">#</a> 查询变慢</h3> <ul><li>SQL相关
<ul><li>没有建索引，导致全表查询</li> <li>查询语句写的烂</li> <li>太多表join</li></ul></li> <li>服务器相关
<ul><li>服务器调优以及各个参数的设置（缓冲，线程数）</li></ul></li></ul> <h3 id="常见join"><a href="#常见join" class="header-anchor">#</a> 常见join</h3> <p><img src="F:%5CtyporaImg%5C1579570912871.png" alt="1579570912871"></p> <h3 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h3> <p>索引即是有序的快速查找的数据结构。</p> <h4 id="种类"><a href="#种类" class="header-anchor">#</a> 种类</h4> <ul><li><p>单值索引</p> <p>一个索引是包含一列</p></li> <li><p>复合索引</p> <p>一个索引包含多列，通常我们都建立的是复合索引，根据经常查找的字段来建立。</p></li> <li><p>唯一索引</p> <p>索引值的值必须唯一，但允许有空值。id默认是唯一索引。</p></li></ul> <h4 id="优势"><a href="#优势" class="header-anchor">#</a> <strong>优势</strong></h4> <ul><li>加快数据查找速度，降低IO成本</li> <li>通过索引对数据进行排序（B+树），降低数据排序成本。降低了CPU的消耗</li></ul> <h4 id="劣势"><a href="#劣势" class="header-anchor">#</a> <strong>劣势</strong></h4> <ul><li>索引也是一张表，是占用存储空间的，保存了主键和索引字段。通常建立符合索引不宜建立太长的索引。</li> <li>索引加快了数据查找的速度，但是更新、插入、删除操作却会变慢，因为每次都会影响索引的结构。</li> <li>需要花费时间来建立和优化索引。</li></ul> <h4 id="语法"><a href="#语法" class="header-anchor">#</a> <strong>语法</strong></h4> <p><img src="F:%5CtyporaImg%5C1579703209200.png" alt="1579703209200"></p> <h3 id="explain"><a href="#explain" class="header-anchor">#</a> explain</h3> <h4 id="用法"><a href="#用法" class="header-anchor">#</a> 用法</h4> <p>explain + SQL语句</p> <h4 id="用途"><a href="#用途" class="header-anchor">#</a> 用途</h4> <ul><li>查看表的读取顺序</li> <li>数据读取操作的操作类型</li> <li>那些索引可以使用</li> <li>哪些索引被实际使用</li> <li>表之间的引用</li> <li>每张表有多少行被优化</li></ul> <h4 id="字段"><a href="#字段" class="header-anchor">#</a> 字段</h4> <ul><li><p>id</p></li> <li><p>select_type</p></li> <li><p>table type</p></li> <li><p>possible_keys</p></li> <li><p>key</p></li> <li><p>key_len</p></li> <li><p>ref</p></li> <li><p>rows</p></li> <li><p>Extra</p></li></ul> <h3 id="索引优化"><a href="#索引优化" class="header-anchor">#</a> 索引优化</h3> <h4 id="索引失效"><a href="#索引失效" class="header-anchor">#</a> 索引失效</h4> <ul><li>全值匹配</li> <li><strong>最左前缀法则</strong></li> <li>不要在索引列上做任何操作（查找时使用计算、函数、（自动或手动）的类型转换）</li> <li>索引列范围查询后面的索引会失效</li> <li>尽量使用覆盖索引（即访问索引的查询（建立的所有索引列））,尽量不用*</li> <li>使用!= 或 &lt;&gt;的时候会导致全表扫描而不用索引。</li> <li>is null 或者is not null也无法使用索引。</li> <li>like的通配符%出现在左边的时候无法使用索引如（%ike...）,会导致全表扫描。</li> <li>字符串不加单引号导致索引失效。（即类型转换了）</li> <li>少用or，or连接会导致索引失效</li></ul> <p><img src="F:%5CtyporaImg%5C1579680384230.png" alt="1579680384230"></p> <h3 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h3> <p>锁是用于协调进程和线程的并发访问资源的机制。</p> <p><img src="F:%5CtyporaImg%5C1579683621572.png" alt="1579683621572"></p> <p><img src="F:%5CtyporaImg%5C1579683646294.png" alt="1579683646294"></p> <h3 id="show-profile"><a href="#show-profile" class="header-anchor">#</a> Show Profile</h3> <p>诊断SQL，分析当前会话中的语句执行造成的资源消耗情况，可以作为对SQL调优的参考。</p> <p>默认情况下属于关闭状态，并保存最近<strong>15</strong>次SQL运行的结果。</p> <p><strong>查看当前MySQL是否支持profile</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&quot;profiling%&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>开启profile</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">set</span> profiling<span class="token operator">=</span><span class="token keyword">on</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>查看结果</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> profiles<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>诊断SQL</strong></p> <p><img src="F:%5CtyporaImg%5C1579694998967.png" alt="1579694998967"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>prifile中的耗时操作</strong></p> <ul><li><code>convert heap to MyISAM</code> 查询结果太大， 内存不够往磁盘上搬</li> <li><code>creating tem table</code> 创建临时表（拷贝数据到临时表，删除临时表）</li> <li><code>copying to tem table on disk</code> 把内存中的临时表复制到磁盘，危险！</li> <li><code>locked</code> 被加锁了</li></ul> <h4 id="锁粒度"><a href="#锁粒度" class="header-anchor">#</a> 锁粒度</h4> <ul><li><p>表锁（偏读）</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 给一张表加上读锁或者写锁</span>

<span class="token comment"># 读锁是共享锁，多个连接或客户端都可读取访问，但是不能修改。加读锁的session不能读其他的表。当前sesstion插入或者更新锁定的表都会报错，其它session插入或者更新或阻塞等待锁的释放。</span>

<span class="token comment"># 写锁是排他锁，只有加锁的session才能进行读和写操作，其它session不能读和写，会被阻塞。</span>
<span class="token comment"># 当前session不能读和修改其它的表。</span>

<span class="token comment"># 简言之，读锁会阻塞写，写锁会阻塞读和写。</span>
<span class="token keyword">lock</span> <span class="token keyword">table</span> tablename <span class="token keyword">read</span><span class="token operator">/</span>wirte<span class="token punctuation">;</span>

<span class="token comment"># 解锁</span>
<span class="token keyword">unlock</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>行锁（偏写）</p> <p>MySQL默认自动提交，可以先将自动提交关闭，<code>set autocommit 0</code>，当前session修改第四行，其它session就修改第四行就会被阻塞，知道当前session被提交。</p></li></ul> <h3 id="索引失效导致行锁变表锁"><a href="#索引失效导致行锁变表锁" class="header-anchor">#</a> 索引失效导致行锁变表锁</h3> <p>​		索引失效会导致行锁编程表锁。比如修改varchar类型但是传入整形，使数据库内部进行类型转换导致索引失效，此时修改成功但是未提交的情况下会锁住整个表。其它session无法对该表的其它数据进行修改。</p> <h3 id="间隙锁"><a href="#间隙锁" class="header-anchor">#</a> 间隙锁</h3> <p>间隙锁插入的问题</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># user表有两列 age(int) 和 name(varchar)</span>
<span class="token comment"># 假设user表的age为12的为空，A session执行</span>
<span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> name<span class="token operator">=</span><span class="token string">'Lee'</span> <span class="token keyword">where</span> age <span class="token operator">&lt;</span> <span class="token number">18</span> <span class="token operator">and</span> age <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># B session执行,此时会发生阻塞，直到A session提交后这个插入命令才被执行</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span> <span class="token keyword">value</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'Mike'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当我们使用范围条件而不是相等条件的时候，刚好范围中可能有不存在的值，就叫<code>间隙（GAP）</code>，InnoDB会对这些范围内的索引项进行加锁；当另一个事务对这些间隙进行插入操作的时候，就会导致阻塞的问题。</p> <p>InnoDB对这个“间隙”加锁，这个就叫做间隙锁（Next-key锁）</p> <h4 id="危害"><a href="#危害" class="header-anchor">#</a> 危害</h4> <p>因为InnoDB会锁定范围内所有的索引键值，即使这个键值并不存在，导致一些不存在的键值被无辜锁定，所以这是无法插入锁定键值范围内的任何数据。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/数据库/redis的数据库.html" class="prev">
        redis的数据库
      </a></span> <span class="next"><a href="/数据库/MongoDB权威指南.html">
        MongoDB权威指南
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1b94221b.js" defer></script><script src="/assets/js/2.60568d92.js" defer></script><script src="/assets/js/19.638c9ba4.js" defer></script>
  </body>
</html>
