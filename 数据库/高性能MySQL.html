<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL架构与历史 | 文档测试</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Curriculum Vitae">
    <link rel="preload" href="/assets/css/0.styles.40e1e164.css" as="style"><link rel="preload" href="/assets/js/app.1b94221b.js" as="script"><link rel="preload" href="/assets/js/2.60568d92.js" as="script"><link rel="preload" href="/assets/js/38.793a8df9.js" as="script"><link rel="prefetch" href="/assets/js/10.3d4294c4.js"><link rel="prefetch" href="/assets/js/11.14a477ac.js"><link rel="prefetch" href="/assets/js/12.a5ddb7e5.js"><link rel="prefetch" href="/assets/js/13.aae5c909.js"><link rel="prefetch" href="/assets/js/14.ab694e76.js"><link rel="prefetch" href="/assets/js/15.64315535.js"><link rel="prefetch" href="/assets/js/16.73da9ac4.js"><link rel="prefetch" href="/assets/js/17.a93d8ff3.js"><link rel="prefetch" href="/assets/js/18.b4ced15b.js"><link rel="prefetch" href="/assets/js/19.638c9ba4.js"><link rel="prefetch" href="/assets/js/20.b2eb7bf9.js"><link rel="prefetch" href="/assets/js/21.48394f3a.js"><link rel="prefetch" href="/assets/js/22.35e8a3cc.js"><link rel="prefetch" href="/assets/js/23.552730b3.js"><link rel="prefetch" href="/assets/js/24.e9135eeb.js"><link rel="prefetch" href="/assets/js/25.81b2ea1d.js"><link rel="prefetch" href="/assets/js/26.75302b23.js"><link rel="prefetch" href="/assets/js/27.9e876760.js"><link rel="prefetch" href="/assets/js/28.57922220.js"><link rel="prefetch" href="/assets/js/29.68fbb04d.js"><link rel="prefetch" href="/assets/js/3.fe45d089.js"><link rel="prefetch" href="/assets/js/30.a98a6693.js"><link rel="prefetch" href="/assets/js/31.8202c39f.js"><link rel="prefetch" href="/assets/js/32.febfda4f.js"><link rel="prefetch" href="/assets/js/33.5ae3ee39.js"><link rel="prefetch" href="/assets/js/34.15947107.js"><link rel="prefetch" href="/assets/js/35.d3f8c53a.js"><link rel="prefetch" href="/assets/js/36.b7fee681.js"><link rel="prefetch" href="/assets/js/37.c13c8f17.js"><link rel="prefetch" href="/assets/js/4.4d86075a.js"><link rel="prefetch" href="/assets/js/5.d5b9441a.js"><link rel="prefetch" href="/assets/js/6.19d672a5.js"><link rel="prefetch" href="/assets/js/7.5f6998cb.js"><link rel="prefetch" href="/assets/js/8.f35ecf57.js"><link rel="prefetch" href="/assets/js/9.99850ec9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.40e1e164.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档测试</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>数据库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/数据库/redis的原子性.html" class="sidebar-link">redis的原子性</a></li><li><a href="/数据库/MongoDB总结.html" class="sidebar-link">MongoDB总结</a></li><li><a href="/数据库/redis的数据库.html" class="sidebar-link">redis的数据库</a></li><li><a href="/数据库/MySQL基础与高级.html" class="sidebar-link">基础</a></li><li><a href="/数据库/MongoDB权威指南.html" class="sidebar-link">MongoDB权威指南</a></li><li><a href="/数据库/redis设计与实现.html" class="sidebar-link">数据结构与对象</a></li><li><a href="/数据库/MySQL的join原理.html" class="sidebar-link">/数据库/MySQL的join原理.html</a></li><li><a href="/数据库/MySQL性能优化.html" class="sidebar-link">/数据库/MySQL性能优化.html</a></li><li><a href="/数据库/MySQL总结.html" class="sidebar-link">MySQL总结</a></li><li><a href="/数据库/乐观锁和悲观锁.html" class="sidebar-link">乐观锁和悲观锁</a></li><li><a href="/数据库/redis(图灵学院).html" class="sidebar-link">什么是Redis</a></li><li><a href="/数据库/Redis总结.html" class="sidebar-link">Redis总结</a></li><li><a href="/数据库/Redis底层数据结构及其编码和优点.html" class="sidebar-link">Redis底层数据结构及其编码和优点</a></li><li><a href="/数据库/MySQL索引最佳实践.html" class="sidebar-link">/数据库/MySQL索引最佳实践.html</a></li><li><a href="/数据库/redis的事件.html" class="sidebar-link">Redis的事件</a></li><li><a href="/数据库/springboot使用h2数据库.html" class="sidebar-link">/数据库/springboot使用h2数据库.html</a></li><li><a href="/数据库/关于NoSQL.html" class="sidebar-link">NoSQL数据库的四大分类</a></li><li><a href="/数据库/布隆过滤器.html" class="sidebar-link">布隆过滤器</a></li><li><a href="/数据库/数据库基础和规范.html" class="sidebar-link">数据库建表规则（三大范式）</a></li><li><a href="/数据库/索引优化ORDER BY排序语句.html" class="sidebar-link">索引优化ORDER BY排序语句</a></li><li><a href="/数据库/覆盖索引，回表查询.html" class="sidebar-link">覆盖索引，回表查询</a></li><li><a href="/数据库/高性能MySQL.html" class="active sidebar-link">MySQL架构与历史</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/数据库/高性能MySQL.html#mysql架构与历史" class="sidebar-link">MySQL架构与历史</a></li><li class="sidebar-sub-header"><a href="/数据库/高性能MySQL.html#mysql基准测试" class="sidebar-link">MySQL基准测试</a></li><li class="sidebar-sub-header"><a href="/数据库/高性能MySQL.html#服务器性能剖析" class="sidebar-link">服务器性能剖析</a></li><li class="sidebar-sub-header"><a href="/数据库/高性能MySQL.html#schema（架构）与数据类型优化" class="sidebar-link">Schema（架构）与数据类型优化</a></li><li class="sidebar-sub-header"><a href="/数据库/高性能MySQL.html#创建高性能的索引" class="sidebar-link">创建高性能的索引</a></li><li class="sidebar-sub-header"><a href="/数据库/高性能MySQL.html#查询性能优化" class="sidebar-link">查询性能优化</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="mysql架构与历史"><a href="#mysql架构与历史" class="header-anchor">#</a> MySQL架构与历史</h2> <h3 id="mysql逻辑架构"><a href="#mysql逻辑架构" class="header-anchor">#</a> MySQL逻辑架构</h3> <p><img src="F:%5CtyporaImg%5C1573630121897.png" alt="1573630121897"></p> <h3 id="并发控制"><a href="#并发控制" class="header-anchor">#</a> 并发控制</h3> <p>​		主要在服务器层与存储引擎层来讨论。</p> <h4 id="读写锁"><a href="#读写锁" class="header-anchor">#</a> 读写锁</h4> <p>​		用户在并发读取数据的时候不会发生什么问题，但是当一个用户读取数据的时候，另一个用户删除了该数据，那么可能发生生不确定的后果。</p> <p><img src="F:%5CtyporaImg%5C1573630236007.png" alt="1573630236007"></p> <h4 id="锁粒度"><a href="#锁粒度" class="header-anchor">#</a> 锁粒度</h4> <p><img src="F:%5CtyporaImg%5C1573630342932.png" alt="1573630342932"></p> <p>​		加锁也需要消耗资源。锁的各种操作，都会增加系统的开销。我们需要了解一些重要的锁策略。</p> <h5 id="表锁（table-lock）"><a href="#表锁（table-lock）" class="header-anchor">#</a> 表锁（table lock）</h5> <p><img src="F:%5CtyporaImg%5C1573630441778.png" alt="1573630441778"></p> <h5 id="行级锁（row-lock）"><a href="#行级锁（row-lock）" class="header-anchor">#</a> 行级锁（row lock）</h5> <p><img src="F:%5CtyporaImg%5C1573630479193.png" alt="1573630479193"></p> <h3 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h3> <p>​		事务的<strong>ACID</strong>概念：<strong>原子性（atomicity），一致性（consistency），隔离性（isolation），持久性（durability）</strong></p> <p><img src="F:%5CtyporaImg%5C1573630599393.png" alt="1573630599393"></p> <h4 id="隔离级别"><a href="#隔离级别" class="header-anchor">#</a> 隔离级别</h4> <p>​		隔离级别有4个： <strong>未提交读（read uncommited），提交读（read commited），可重复读（repeatable read），可串行化（serializable)</strong></p> <p><img src="F:%5CtyporaImg%5C1573630715627.png" alt="1573630715627"></p> <h4 id="mysql中的事务"><a href="#mysql中的事务" class="header-anchor">#</a> MySQL中的事务</h4> <p>​		MySQL提供了两种事务性的存储引擎：<strong>InnoDB和NDB Cluster</strong>。</p> <h5 id="自动提交（autocommit）"><a href="#自动提交（autocommit）" class="header-anchor">#</a> 自动提交（autocommit）</h5> <p><img src="F:%5CtyporaImg%5C1573630832753.png" alt="1573630832753"></p> <h5 id="设置隔离级别"><a href="#设置隔离级别" class="header-anchor">#</a> 设置隔离级别</h5> <p><img src="F:%5CtyporaImg%5C1573630893802.png" alt="1573630893802"></p> <h3 id="多版本并发控制（mvcc）"><a href="#多版本并发控制（mvcc）" class="header-anchor">#</a> 多版本并发控制（MVCC）</h3> <p><img src="F:%5CtyporaImg%5C1573631010472.png" alt="1573631010472"></p> <p>​		<code>MVCC</code>可以理解为行级锁的变种，很多情况下避免了加锁操作，降低了开销，实现了非阻塞的读操作，写操作时只锁定必要的行。</p> <p>​		<code>MVCC</code>实现的不同的，典型的有<strong>乐观并发控制和悲观并发控制。</strong></p> <p>​		<code>InnoDB</code>的<code>MVCC</code>通过每行记录后面保存两个隐藏的列来实现。一个保存了行的创建时间，一个保存行的过期时间（或删除时间）。<strong>存储的是时间值实际是系统版本号</strong>（system version number）。<strong>每开始一个事务，系统版本号都会自动递增。</strong><img src="F:%5CtyporaImg%5C1573631467728.png" alt="1573631467728"></p> <p><img src="F:%5CtyporaImg%5C1573631399734.png" alt="1573631399734"></p> <p>​</p> <h3 id="mysql的存储引擎"><a href="#mysql的存储引擎" class="header-anchor">#</a> MySQL的存储引擎</h3> <h4 id="查看表的信息"><a href="#查看表的信息" class="header-anchor">#</a> 查看表的信息</h4> <p><img src="F:%5CtyporaImg%5C1573631645913.png" alt="1573631645913"></p> <p>​		其中<strong>engine</strong>中的信息代表存储引擎的类型。</p> <p>​		<strong>MySQL的默认存储引擎是InnoDB</strong>。我们在选择存储引擎的时候需要考虑多个因素：</p> <ul><li>事务</li> <li>备份</li> <li>崩溃恢复</li> <li>特有的特性（如MyISAM支持地理空间搜索）</li></ul> <h4 id="切换表的存储引擎"><a href="#切换表的存储引擎" class="header-anchor">#</a> 切换表的存储引擎</h4> <p><img src="F:%5CtyporaImg%5C1573632150281.png" alt="1573632150281"></p> <h2 id="mysql基准测试"><a href="#mysql基准测试" class="header-anchor">#</a> MySQL基准测试</h2> <h3 id="为什么需要基准测试"><a href="#为什么需要基准测试" class="header-anchor">#</a> 为什么需要基准测试</h3> <p>​		基准测试时唯一方便有效的测试系统在给定的工作负载或者不同压力下会发生什么情况。</p> <p><img src="F:%5CtyporaImg%5C1573632617131.png" alt="1573632617131"></p> <p><img src="F:%5CtyporaImg%5C1573632627650.png" alt="1573632627650"></p> <h3 id="基准测试的策略"><a href="#基准测试的策略" class="header-anchor">#</a> 基准测试的策略</h3> <p>​		有两个策略：<strong>针对整个系统的整体测试；单独测试MySQL。也成为集成式以及单组件式。</strong></p> <h4 id="测试指标"><a href="#测试指标" class="header-anchor">#</a> 测试指标</h4> <ul><li><strong>吞吐量</strong> - 单位时间内的事务处理数</li> <li><strong>响应时间或延迟</strong> - 测试任务所需的整体时间</li> <li><strong>并发性</strong> - 任意时间有多少同时发生的并发请求</li></ul> <p><img src="F:%5CtyporaImg%5C1573633958838.png" alt="1573633958838"></p> <p><img src="F:%5CtyporaImg%5C1573633868095.png" alt="1573633868095"></p> <ul><li><strong>可拓展性</strong> - 系统的性能还可承受多少压力</li></ul> <h3 id="基准测试方法"><a href="#基准测试方法" class="header-anchor">#</a> 基准测试方法</h3> <h3 id="基准测试工具"><a href="#基准测试工具" class="header-anchor">#</a> 基准测试工具</h3> <h4 id="集成式测试工具"><a href="#集成式测试工具" class="header-anchor">#</a> 集成式测试工具</h4> <ul><li>ab</li> <li>http_load</li> <li>JMeter</li></ul> <h4 id="单组件式测试工具"><a href="#单组件式测试工具" class="header-anchor">#</a> 单组件式测试工具</h4> <ul><li>mysqlslap</li> <li>sql-bench</li> <li>super smack</li> <li>database test suite</li></ul> <p><img src="F:%5CtyporaImg%5C1573634541213.png" alt="1573634541213"></p> <h2 id="服务器性能剖析"><a href="#服务器性能剖析" class="header-anchor">#</a> 服务器性能剖析</h2> <h2 id="schema（架构）与数据类型优化"><a href="#schema（架构）与数据类型优化" class="header-anchor">#</a> Schema（架构）与数据类型优化</h2> <h3 id="选择优化的数据类型"><a href="#选择优化的数据类型" class="header-anchor">#</a> 选择优化的数据类型</h3> <p>​		选择正确的数据类型对于获得高性能来说很重要，通常来说选择应该遵循以下原则：</p> <ul><li><p>更小的通常更好（比如只需要存0-200 则使用tinyint unsigned 更好）</p> <p><img src="F:%5CtyporaImg%5C1574232855609.png" alt="1574232855609"></p></li> <li><p>简单就好</p></li></ul> <p><img src="F:%5CtyporaImg%5C1574232982204.png" alt="1574232982204"></p> <ul><li>尽量避免NULL</li></ul> <p><img src="F:%5CtyporaImg%5C1574233096665.png" alt="1574233096665"></p> <h4 id="整数类型"><a href="#整数类型" class="header-anchor">#</a> 整数类型</h4> <p><img src="F:%5CtyporaImg%5C1574233439101.png" alt="1574233439101"></p> <h4 id="字符串类型"><a href="#字符串类型" class="header-anchor">#</a> 字符串类型</h4> <p><strong>分为varchar和char类型</strong></p> <ul><li>varchar（存储可变长字符串）</li></ul> <p><img src="F:%5CtyporaImg%5C1574233633803.png" alt="1574233633803"></p> <p><img src="F:%5CtyporaImg%5C1574233739690.png" alt="1574233739690"></p> <ul><li>char（存储定长字符串）</li></ul> <p><img src="F:%5CtyporaImg%5C1574233818183.png" alt="1574233818183"></p> <h5 id="blob和text类型"><a href="#blob和text类型" class="header-anchor">#</a> BLOB和TEXT类型</h5> <p><img src="F:%5CtyporaImg%5C1574233995372.png" alt="1574233995372"></p> <h4 id="日期和时间类型"><a href="#日期和时间类型" class="header-anchor">#</a> 日期和时间类型</h4> <p><img src="F:%5CtyporaImg%5C1574234504443.png" alt="1574234504443"></p> <p>两种相似的日期类型：datetime和timestamp</p> <h4 id="位数据类型"><a href="#位数据类型" class="header-anchor">#</a> 位数据类型</h4> <p>BIT</p> <h4 id="特殊类型数据"><a href="#特殊类型数据" class="header-anchor">#</a> 特殊类型数据</h4> <p><img src="F:%5CtyporaImg%5C1574234745540.png" alt="1574234745540"></p> <h3 id="加快alter-table操作的速度"><a href="#加快alter-table操作的速度" class="header-anchor">#</a> 加快ALTER TABLE操作的速度</h3> <h4 id="快速创建myisam索引"><a href="#快速创建myisam索引" class="header-anchor">#</a> 快速创建MyISAM索引</h4> <p><img src="F:%5CtyporaImg%5C1574237471164.png" alt="1574237471164"></p> <h2 id="创建高性能的索引"><a href="#创建高性能的索引" class="header-anchor">#</a> 创建高性能的索引</h2> <p>​		<strong>索引是存储引擎快速找到记录的一种数据结构</strong>。数据量小的时候，索引的作用可能不大，当时当数据量大起来的时候，索引的重要性就愈发重要。</p> <h3 id="索引基础"><a href="#索引基础" class="header-anchor">#</a> 索引基础</h3> <h4 id="索引类型"><a href="#索引类型" class="header-anchor">#</a> 索引类型</h4> <ul><li>B-Tree索引</li></ul> <p><img src="F:%5CtyporaImg%5C1574387893713.png" alt="1574387893713"></p> <p>B-Tree的表示</p> <p><img src="F:%5CtyporaImg%5C1574393891039.png" alt="1574393891039"></p> <ul><li>哈希索引</li></ul> <p><img src="F:%5CtyporaImg%5C1574407312014.png" alt="1574407312014"></p> <p>加入有以下数据</p> <p><img src="F:%5CtyporaImg%5C1574407414051.png" alt="1574407414051"></p> <p>有一个哈希函数f(x)，他返回下面的哈希值</p> <p><img src="F:%5CtyporaImg%5C1574407447797.png" alt="1574407447797"></p> <p>则哈希索引的数据结构如下：</p> <p><img src="F:%5CtyporaImg%5C1574407465670.png" alt="1574407465670"></p> <p>假如要查询一个数据</p> <p><code>mysq&gt; select lname from testhash where fname = 'Peter';</code></p> <p><img src="F:%5CtyporaImg%5C1574407562836.png" alt="1574407562836"></p> <p><strong>哈希索引的限制：</strong></p> <p><img src="F:%5CtyporaImg%5C1574407661544.png" alt="1574407661544"></p> <p><img src="F:%5CtyporaImg%5C1574407671012.png" alt="1574407671012"></p> <ul><li>空间数据索引（R-Tree）</li></ul> <p><img src="F:%5CtyporaImg%5C1574585145543.png" alt="1574585145543"></p> <ul><li>全文索引</li></ul> <p><img src="F:%5CtyporaImg%5C1574585162306.png" alt="1574585162306"></p> <h3 id="索引的优点"><a href="#索引的优点" class="header-anchor">#</a> 索引的优点</h3> <p>总结下来有三个优点：</p> <h3 id="高性能的索引策略🔺"><a href="#高性能的索引策略🔺" class="header-anchor">#</a> <img src="F:%5CtyporaImg%5C1574585197522.png" alt="1574585197522">高性能的索引策略🔺</h3> <h4 id="独立的列"><a href="#独立的列" class="header-anchor">#</a> 独立的列</h4> <p><img src="F:%5CtyporaImg%5C1574585649795.png" alt="1574585649795"></p> <h4 id="前缀索引和索引选择性"><a href="#前缀索引和索引选择性" class="header-anchor">#</a> 前缀索引和索引选择性</h4> <p>​		索引很长的字符串，可以使用哈希索引，不过还不够，还可以使用前缀索引。之索引开始的部分字符，这样可以大大节约索引的空间。从而提高效率。</p> <p><strong>步骤</strong>：</p> <ul><li>先找到合适的前缀长度</li> <li>创建前缀索引</li></ul> <p><strong>缺点</strong>：</p> <p><img src="F:%5CtyporaImg%5C1574586375203.png" alt="1574586375203"></p> <h3 id="多列索引"><a href="#多列索引" class="header-anchor">#</a> 多列索引</h3> <p><img src="F:%5CtyporaImg%5C1574596833025.png" alt="1574596833025"></p> <h3 id="选择合适的索引列顺序"><a href="#选择合适的索引列顺序" class="header-anchor">#</a> 选择合适的索引列顺序</h3> <p><img src="F:%5CtyporaImg%5C1574596948004.png" alt="1574596948004"></p> <p>可以先衡量customer_id和staff_id的数据数量，将数据少的索引放前面。</p> <h3 id="聚簇索引🔺"><a href="#聚簇索引🔺" class="header-anchor">#</a> 聚簇索引🔺</h3> <p>P00</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>​		MySQL大多数情况下使用B-Tree索引。</p> <p>​		在选择索引和编写利用这些索引查询时，有三个原则：</p> <p><img src="F:%5CtyporaImg%5C1574693773097.png" alt="1574693773097"></p> <h2 id="查询性能优化"><a href="#查询性能优化" class="header-anchor">#</a> 查询性能优化</h2> <h3 id="慢查询基础：优化数据访问"><a href="#慢查询基础：优化数据访问" class="header-anchor">#</a> 慢查询基础：优化数据访问</h3> <p>MySQL能够使用如下三种方式应用where条件，从好到坏一次为：</p> <p><img src="F:%5CtyporaImg%5C1575029172115.png" alt="1575029172115"></p> <p>​		好的索引对于数据的访问来说很重要，可以减少扫描的行数。<strong>尽量让扫描的行数和实际返回的行数在数量上接近。</strong></p> <p>​		如果扫描很多行，但是却返回很少行的话，我们可以采用以下的优化。</p> <p><img src="F:%5CtyporaImg%5C1575029417174.png" alt="1575029417174"></p> <h3 id="重构查询方式"><a href="#重构查询方式" class="header-anchor">#</a> 重构查询方式</h3> <h4 id="复杂查询还是多个检查查询"><a href="#复杂查询还是多个检查查询" class="header-anchor">#</a> 复杂查询还是多个检查查询</h4> <p><img src="F:%5CtyporaImg%5C1575030019623.png" alt="1575030019623"></p> <h4 id="切分查询（分而治之）"><a href="#切分查询（分而治之）" class="header-anchor">#</a> 切分查询（分而治之）</h4> <p><img src="F:%5CtyporaImg%5C1575030100480.png" alt="1575030100480"></p> <p>将一个删除操作分次进行，可以将服务器一次性的压力分散到一个很长的时间段。可以大大减少删除时锁的持有时间。</p> <h4 id="分解关联查询"><a href="#分解关联查询" class="header-anchor">#</a> 分解关联查询</h4> <p><img src="F:%5CtyporaImg%5C1575030948156.png" alt="1575030948156"></p> <p>优势如下：</p> <ul><li>第一次查询的tag=‘mysql’已经缓存，下面的查询就不用再去查询tag了。</li> <li>拆分可以降低锁的竞争</li></ul> <p><img src="F:%5CtyporaImg%5C1575031079330.png" alt="1575031079330"></p> <h3 id="查询的执行"><a href="#查询的执行" class="header-anchor">#</a> 查询的执行</h3> <p>​		MySQL的查询过程</p> <p><img src="F:%5CtyporaImg%5C1575031288484.png" alt="1575031288484"></p> <ol><li>先查询缓存，如果之前查过则直接返回。</li> <li>通过解析器解析SQL，进行预处理，还有优化器生成对应的执行计划。</li> <li>根据执行计划调用查询引擎的API来执行查询。</li> <li>返回结果。</li></ol> <h3 id="mysql客户端-服务端的通信协议"><a href="#mysql客户端-服务端的通信协议" class="header-anchor">#</a> MySQL客户端/服务端的通信协议</h3> <p>​		客户端与服务端的通信协议是<strong>半双工</strong>的，意味着：</p> <p><img src="F:%5CtyporaImg%5C1575031461407.png" alt="1575031461407"></p> <h4 id="查询优化处理"><a href="#查询优化处理" class="header-anchor">#</a> 查询优化处理</h4> <p>下面是MySQL能够处理的优化类型：</p> <ul><li>重新定义关联表的顺序</li> <li>将外连接转化成内连接</li></ul> <p><img src="F:%5CtyporaImg%5C1575033202103.png" alt="1575033202103"></p> <ul><li>使用等价变换规则</li></ul> <p><img src="F:%5CtyporaImg%5C1575033299562.png" alt="1575033299562"></p> <ul><li>优化count(), min(), max()</li> <li>预估并转化为常数表达式</li> <li>覆盖索引扫描</li> <li>子查询优化</li> <li>提前终止查询</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/数据库/覆盖索引，回表查询.html" class="prev">
        覆盖索引，回表查询
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1b94221b.js" defer></script><script src="/assets/js/2.60568d92.js" defer></script><script src="/assets/js/38.793a8df9.js" defer></script>
  </body>
</html>
