<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、redis连接 | 文档测试</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Curriculum Vitae">
    <link rel="preload" href="/assets/css/0.styles.40e1e164.css" as="style"><link rel="preload" href="/assets/js/app.1b94221b.js" as="script"><link rel="preload" href="/assets/js/2.60568d92.js" as="script"><link rel="preload" href="/assets/js/14.ab694e76.js" as="script"><link rel="prefetch" href="/assets/js/10.3d4294c4.js"><link rel="prefetch" href="/assets/js/11.14a477ac.js"><link rel="prefetch" href="/assets/js/12.a5ddb7e5.js"><link rel="prefetch" href="/assets/js/13.aae5c909.js"><link rel="prefetch" href="/assets/js/15.64315535.js"><link rel="prefetch" href="/assets/js/16.73da9ac4.js"><link rel="prefetch" href="/assets/js/17.a93d8ff3.js"><link rel="prefetch" href="/assets/js/18.b4ced15b.js"><link rel="prefetch" href="/assets/js/19.638c9ba4.js"><link rel="prefetch" href="/assets/js/20.b2eb7bf9.js"><link rel="prefetch" href="/assets/js/21.48394f3a.js"><link rel="prefetch" href="/assets/js/22.35e8a3cc.js"><link rel="prefetch" href="/assets/js/23.552730b3.js"><link rel="prefetch" href="/assets/js/24.e9135eeb.js"><link rel="prefetch" href="/assets/js/25.81b2ea1d.js"><link rel="prefetch" href="/assets/js/26.75302b23.js"><link rel="prefetch" href="/assets/js/27.9e876760.js"><link rel="prefetch" href="/assets/js/28.57922220.js"><link rel="prefetch" href="/assets/js/29.68fbb04d.js"><link rel="prefetch" href="/assets/js/3.fe45d089.js"><link rel="prefetch" href="/assets/js/30.a98a6693.js"><link rel="prefetch" href="/assets/js/31.8202c39f.js"><link rel="prefetch" href="/assets/js/32.febfda4f.js"><link rel="prefetch" href="/assets/js/33.5ae3ee39.js"><link rel="prefetch" href="/assets/js/34.15947107.js"><link rel="prefetch" href="/assets/js/35.d3f8c53a.js"><link rel="prefetch" href="/assets/js/36.b7fee681.js"><link rel="prefetch" href="/assets/js/37.c13c8f17.js"><link rel="prefetch" href="/assets/js/38.793a8df9.js"><link rel="prefetch" href="/assets/js/4.4d86075a.js"><link rel="prefetch" href="/assets/js/5.d5b9441a.js"><link rel="prefetch" href="/assets/js/6.19d672a5.js"><link rel="prefetch" href="/assets/js/7.5f6998cb.js"><link rel="prefetch" href="/assets/js/8.f35ecf57.js"><link rel="prefetch" href="/assets/js/9.99850ec9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.40e1e164.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档测试</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/learning-notes/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/zhaotbj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Python</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/Python核心知识.html" class="sidebar-link">/python/Python核心知识.html</a></li><li><a href="/python/Python魔术方法.html" class="sidebar-link">介绍</a></li><li><a href="/python/python中redis操作.html" class="active sidebar-link">1、redis连接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_1、redis连接" class="sidebar-link">1、redis连接</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_2、连接池" class="sidebar-link">2、连接池</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_3、redis基本命令-string" class="sidebar-link">3、redis基本命令 String</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_4、redis基本命令-hash" class="sidebar-link">4、redis基本命令 hash</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_5、redis基本命令-list" class="sidebar-link">5、redis基本命令 list</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_6、redis基本命令-set" class="sidebar-link">6、redis基本命令 set</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_7、redis基本命令-有序set" class="sidebar-link">7、redis基本命令 有序set</a></li><li class="sidebar-sub-header"><a href="/python/python中redis操作.html#_8、其他常用操作" class="sidebar-link">8、其他常用操作</a></li></ul></li><li><a href="/python/动态加载模块和类.html" class="sidebar-link">python - 动态加载模块和类</a></li><li><a href="/python/虚拟环境.html" class="sidebar-link">/python/虚拟环境.html</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1、redis连接"><a href="#_1、redis连接" class="header-anchor">#</a> 1、redis连接</h2> <blockquote><p>redis提供两个类Redis和StrictRedis用于实现Redis的命令，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py。</p></blockquote> <blockquote><p>redis连接实例是线程安全的，可以直接将redis连接实例设置为一个全局变量，直接使用。如果需要另一个Redis实例（or Redis数据库）时，就需要重新创建redis连接实例来获取一个新的连接。同理，python的redis没有实现select命令。</p></blockquote> <p>安装redis</p> <div class="language-undefined line-numbers-mode"><pre class="language-text"><code>pip install redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>连接redis，加上decode_responses=True，写入的键值对中的value为str类型，不加这个参数写入的则为字节类型。</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> redis   # 导入redis模块，通过python操作redis 也可以直接在redis主机的服务端操作缓存数据库

r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>   # host是redis主机，需要redis服务端和客户端都启动 redis默认端口是<span class="token number">6379</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'junxi'</span><span class="token punctuation">)</span>  # key是<span class="token string">&quot;foo&quot;</span> value是<span class="token string">&quot;bar&quot;</span> 将键值对存入redis缓存
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # 取出键name对应的值
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_2、连接池"><a href="#_2、连接池" class="header-anchor">#</a> 2、连接池</h2> <blockquote><p>redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。
可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池</p></blockquote> <p>连接池</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> redis    <span class="token comment"># 导入redis模块，通过python操作redis 也可以直接在redis主机的服务端操作缓存数据库</span>

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>   <span class="token comment"># host是redis主机，需要redis服务端和客户端都起着 redis默认端口是6379</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span>     <span class="token comment"># key是&quot;gender&quot; value是&quot;male&quot; 将键值对存入redis缓存</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'gender'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment"># gender 取出键male对应的值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3、redis基本命令-string"><a href="#_3、redis基本命令-string" class="header-anchor">#</a> 3、redis基本命令 String</h2> <p>set(name, value, ex=None, px=None, nx=False, xx=False)</p> <p>在Redis中设置值，默认，不存在则创建，存在则修改
参数：
ex，过期时间（秒）
px，过期时间（毫秒）
nx，如果设置为True，则只有name不存在时，当前set操作才执行
xx，如果设置为True，则只有name存在时，当前set操作才执行</p> <p><strong>1.ex，过期时间（秒） 这里过期时间是3秒，3秒后p，键food的值就变成None</strong></p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> redis

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">,</span> <span class="token string">'mutton'</span><span class="token punctuation">,</span> ex<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>    # key是<span class="token string">&quot;food&quot;</span> value是<span class="token string">&quot;mutton&quot;</span> 将键值对存入redis缓存
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # mutton 取出键food对应的值
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>2.px，过期时间（豪秒） 这里过期时间是3豪秒，3毫秒后，键foo的值就变成None</strong></p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> redis

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">,</span> <span class="token string">'beef'</span><span class="token punctuation">,</span> px<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'food'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>3.nx，如果设置为True，则只有name不存在时，当前set操作才执行 （新建）</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> redis

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">,</span> <span class="token string">'watermelon'</span><span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># True--不存在</span>
<span class="token comment"># 如果键fruit不存在，那么输出是True；如果键fruit已经存在，输出是None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>4.xx，如果设置为True，则只有name存在时，当前set操作才执行 （修改）</strong></p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'fruit'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'watermelon'</span><span class="token punctuation">,</span> xx<span class="token operator">=</span><span class="token boolean constant">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token shell-comment comment"># True--已经存在</span>
<span class="token shell-comment comment"># 如果键fruit已经存在，那么输出是True；如果键fruit不存在，输出是None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>5.setnx(name, value)</strong>
设置值，只有name不存在时，执行设置操作（添加）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.setnx<span class="token punctuation">(</span><span class="token string">'fruit1'</span>, <span class="token string">'banana'</span><span class="token punctuation">))</span>  <span class="token comment"># fruit1不存在，输出为True</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>6.setex(name, time, value)</strong>
设置值
参数：
time，过期时间（数字秒 或 timedelta对象）</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
r<span class="token punctuation">.</span>setex<span class="token punctuation">(</span><span class="token string">&quot;fruit2&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'fruit2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 5秒后，取值就从orange变成None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>7.psetex(name, time_ms, value)</strong>
设置值
参数：
time_ms，过期时间（数字毫秒 或 timedelta对象）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.psetex<span class="token punctuation">(</span><span class="token string">&quot;fruit3&quot;</span>, <span class="token number">5000</span>, <span class="token string">&quot;apple&quot;</span><span class="token punctuation">)</span>
time.sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">'fruit3'</span><span class="token punctuation">))</span>  <span class="token comment"># 5000毫秒后，取值就从apple变成None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>**8.mset(*args, <strong>kwargs)</strong>
批量设置值
如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.mget<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'k1'</span><span class="token builtin class-name">:</span> <span class="token string">'v1'</span>, <span class="token string">'k2'</span><span class="token builtin class-name">:</span> <span class="token string">'v2'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
r.mset<span class="token punctuation">(</span>k1<span class="token operator">=</span><span class="token string">&quot;v1&quot;</span>, <span class="token assign-left variable">k2</span><span class="token operator">=</span><span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 这里k1 和k2 不能带引号 一次设置对个键值对</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span>, <span class="token string">&quot;k2&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 一次取出多个键对应的值</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>*<em>9.mget(keys, <em>args)</em></em>
批量获取
如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">'k1'</span>, <span class="token string">'k2'</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'k1'</span>, <span class="token string">'k2'</span><span class="token punctuation">]</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;fruit&quot;</span>, <span class="token string">&quot;fruit1&quot;</span>, <span class="token string">&quot;fruit2&quot;</span>, <span class="token string">&quot;k1&quot;</span>, <span class="token string">&quot;k2&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 将目前redis缓存中的键对应的值批量取出来</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>10.getset(name, value)</strong>
设置新值并获取原来的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.getset<span class="token punctuation">(</span><span class="token string">&quot;food&quot;</span>, <span class="token string">&quot;barbecue&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 设置的新值是barbecue 设置前的值是beef</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>11.getrange(key, start, end)</strong>
获取子序列（根据字节获取，非字符）
参数：
name，Redis 的 name
start，起始位置（字节）
end，结束位置（字节）
如： &quot;君惜大大&quot; ，0-2表示 &quot;君&quot;</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.set<span class="token punctuation">(</span><span class="token string">&quot;cn_name&quot;</span>, <span class="token string">&quot;君惜大大&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 汉字</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">&quot;cn_name&quot;</span>, <span class="token number">0</span>, <span class="token number">2</span><span class="token punctuation">))</span>   <span class="token comment"># 取索引号是0-2 前3位的字节 君 切片操作 （一个汉字3个字节 1个字母一个字节 每个字节8bit）</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">&quot;cn_name&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>  <span class="token comment"># 取所有的字节 君惜大大 切片操作</span>
r.set<span class="token punctuation">(</span><span class="token string">&quot;en_name&quot;</span>,<span class="token string">&quot;junxi&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 字母</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">&quot;en_name&quot;</span>, <span class="token number">0</span>, <span class="token number">2</span><span class="token punctuation">))</span>  <span class="token comment"># 取索引号是0-2 前3位的字节 jun 切片操作 （一个汉字3个字节 1个字母一个字节 每个字节8bit）</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">&quot;en_name&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span> <span class="token comment"># 取所有的字节 junxi 切片操作</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>12.setrange(name, offset, value)</strong>
修改字符串内容，从指定字符串索引开始向后替换（新值太长时，则向后添加）
参数：
offset，字符串的索引，字节（一个汉字三个字节）
value，要设置的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.setrange<span class="token punctuation">(</span><span class="token string">&quot;en_name&quot;</span>, <span class="token number">1</span>, <span class="token string">&quot;ccc&quot;</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">&quot;en_name&quot;</span><span class="token punctuation">))</span>    <span class="token comment"># jccci 原始值是junxi 从索引号是1开始替换成ccc 变成 jccci</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>13.setbit(name, offset, value)</strong>
对name对应值的二进制表示的位进行操作
参数：
name，redis的name
offset，位的索引（将值变换成二进制后再进行索引）
value，值只能是 1 或 0</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>注：如果在Redis中有一个对应： n1 <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span>，
那么字符串foo的二进制表示为：01100110 01101111 01101111
所以，如果执行 setbit<span class="token punctuation">(</span><span class="token string">'n1'</span>, <span class="token number">7</span>, <span class="token number">1</span><span class="token punctuation">)</span>，则就会将第7位设置为1，
那么最终二进制则变成 01100111 01101111 01101111，即：<span class="token string">&quot;goo&quot;</span>

扩展，转换二进制表示：
<span class="token builtin class-name">source</span> <span class="token operator">=</span> <span class="token string">&quot;陈思维&quot;</span>
<span class="token builtin class-name">source</span> <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> source:
num <span class="token operator">=</span> ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
print bin<span class="token punctuation">(</span>num<span class="token punctuation">)</span>.replace<span class="token punctuation">(</span><span class="token string">'b'</span>,<span class="token string">''</span><span class="token punctuation">)</span>
特别的，如果source是汉字 <span class="token string">&quot;陈思维&quot;</span>怎么办？
答：对于utf-8，每一个汉字占 <span class="token number">3</span> 个字节，那么 <span class="token string">&quot;陈思维&quot;</span> 则有 <span class="token number">9</span>个字节
对于汉字，for循环时候会按照 字节 迭代，那么在迭代时，将每一个字节转换 十进制数，然后再将十进制数转换成二进制
<span class="token number">11100110</span> <span class="token number">10101101</span> <span class="token number">10100110</span> <span class="token number">11100110</span> <span class="token number">10110010</span> <span class="token number">10011011</span> <span class="token number">11101001</span> <span class="token number">10111101</span> <span class="token number">10010000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>14.getbit(name, offset)</strong>
获取name对应的值的二进制表示中的某位的值 （0或1）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.getbit<span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span>, <span class="token number">0</span><span class="token punctuation">))</span> <span class="token comment"># 0 foo1 对应的二进制 4个字节 32位 第0位是0还是1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>15.bitcount(key, start=None, end=None)</strong>
获取name对应的值的二进制表示中 1 的个数
参数：
key，Redis的name
start 字节起始位置
end，字节结束位置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># goo1 01100111</span>
print<span class="token punctuation">(</span>r.bitcount<span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span>,0,1<span class="token punctuation">))</span>  <span class="token comment"># 11 表示前2个字节中，1出现的个数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>*<em>16.bitop(operation, dest, <em>keys)</em></em>
获取多个值，并将值做位运算，将最后的结果保存至新的name对应的值</p> <p>参数：
operation,AND（并） 、 OR（或） 、 NOT（非） 、 XOR（异或）
dest, 新的Redis的name
*keys,要查找的Redis的name</p> <p>如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bitop<span class="token punctuation">(</span><span class="token string">&quot;AND&quot;</span>, <span class="token string">'new_name'</span>, <span class="token string">'n1'</span>, <span class="token string">'n2'</span>, <span class="token string">'n3'</span><span class="token punctuation">)</span>
获取Redis中n1,n2,n3对应的值，然后讲所有的值做位运算（求并集），然后将结果保存 new_name 对应的值中
r.set<span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span>,<span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 0110001</span>
r.set<span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span>,<span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 0110010</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span>,<span class="token string">&quot;foo1&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># ['goo1', 'baaanew']</span>
print<span class="token punctuation">(</span>r.bitop<span class="token punctuation">(</span><span class="token string">&quot;AND&quot;</span>,<span class="token string">&quot;new&quot;</span>,<span class="token string">&quot;foo&quot;</span>,<span class="token string">&quot;foo1&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># &quot;new&quot; 0 0110000</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span>,<span class="token string">&quot;foo1&quot;</span>,<span class="token string">&quot;new&quot;</span><span class="token punctuation">))</span>

<span class="token builtin class-name">source</span> <span class="token operator">=</span> <span class="token string">&quot;12&quot;</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> source:
num <span class="token operator">=</span> ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>num<span class="token punctuation">)</span>  <span class="token comment"># 打印每个字母字符或者汉字字符对应的ascii码值 f-102-0b100111-01100111</span>
print<span class="token punctuation">(</span>bin<span class="token punctuation">(</span>num<span class="token punctuation">))</span>  <span class="token comment"># 打印每个10进制ascii码值转换成二进制的值 0b1100110（0b表示二进制）</span>
print bin<span class="token punctuation">(</span>num<span class="token punctuation">)</span>.replace<span class="token punctuation">(</span><span class="token string">'b'</span>,<span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 将二进制0b1100110替换成01100110</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>17.strlen(name)</strong>
返回name对应值的字节长度（一个汉字3个字节）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.strlen<span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 4 'goo1'的长度是4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>18.incr(self, name, amount=1)</strong>
自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。
参数：
name,Redis的name
amount,自增数（必须是整数）
注：同incrby</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>应用场景 – 页面点击数
假定我们对一系列页面需要记录点击次数。例如论坛的每个帖子都要记录点击次数，而点击次数比回帖的次数的多得多。如果使用关系数据库来存储点击，可能存在大量的行级锁争用。所以，<strong>点击数的增加使用redis的INCR命令最好不过了</strong>。
<strong>当redis服务器启动时，可以从关系数据库读入点击数的初始值</strong>（12306这个页面被访问了34634次）</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code>r.<span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;visit:12306:totals&quot;</span><span class="token punctuation">,</span> 34634<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r.<span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;visit:12306:totals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>每当有一个页面点击，则使用INCR增加点击数即可。</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code>r.<span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">&quot;visit:12306:totals&quot;</span><span class="token punctuation">)</span>
r.<span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">&quot;visit:12306:totals&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>页面载入的时候则可直接获取这个值</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token function">print</span><span class="token punctuation">(</span>r.<span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;visit:12306:totals&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>19.incrbyfloat(self, name, amount=1.0)</strong>
自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。
参数：
name,Redis的name
amount,自增数（浮点型）</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123.0&quot;</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;221.0&quot;</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">incrbyfloat</span><span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">incrbyfloat</span><span class="token punctuation">(</span><span class="token string">&quot;foo2&quot;</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">3.0</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>20.decr(self, name, amount=1)</strong>
自减 name对应的值，当name不存在时，则创建name＝amount，否则，则自减。
参数：
name,Redis的name
amount,自减数（整数)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.decr<span class="token punctuation">(</span><span class="token string">&quot;foo4&quot;</span>, <span class="token assign-left variable">amount</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 递减3</span>
r.decr<span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span>, <span class="token assign-left variable">amount</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 递减1</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span>, <span class="token string">&quot;foo4&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>21.append(key, value)</strong>
在redis name对应的值后面追加内容
参数：
key, redis的name
value, 要追加的字符串</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.append<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span>, <span class="token string">&quot;haha&quot;</span><span class="token punctuation">)</span>    <span class="token comment"># 在name对应的值junxi后面追加字符串haha</span>
print<span class="token punctuation">(</span>r.mget<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_4、redis基本命令-hash"><a href="#_4、redis基本命令-hash" class="header-anchor">#</a> 4、redis基本命令 hash</h2> <p><strong>1.单个增加--修改(单个取出)--没有就新增，有的话就修改</strong>
hset(name, key, value)
name对应的hash中设置一个键值对（不存在，则创建；否则，修改）
参数：
name，redis的name
key，name对应的hash中的key
value，name对应的hash中的value
注：
<strong>hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>r<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hkeys<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 取hash中所有的key</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 单个取hash的key对应的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hmget<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 多个取hash的key对应的值</span>
r<span class="token punctuation">.</span>hsetnx<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 只能新建</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>2 批量增加（取出）</strong>
hmset(name, mapping)
在name对应的hash中批量设置键值对
参数：
name，redis的name
mapping，字典，如：{'k1':'v1', 'k2': 'v2'}
如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.hmset<span class="token punctuation">(</span><span class="token string">&quot;hash2&quot;</span>, <span class="token punctuation">{</span><span class="token string">&quot;k2&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v2&quot;</span>, <span class="token string">&quot;k3&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>hget(name,key)
在name对应的hash中获取根据key获取value
hmget(name, keys, *args)
在name对应的hash中获取多个key的值
参数：
name，reids对应的name
keys，要获取key集合，如：['k1', 'k2', 'k3']
*args，要获取的key，如：k1,k2,k3
如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hget<span class="token punctuation">(</span><span class="token string">&quot;hash2&quot;</span>, <span class="token string">&quot;k2&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 单个取出&quot;hash2&quot;的key-k2对应的value</span>
print<span class="token punctuation">(</span>r.hmget<span class="token punctuation">(</span><span class="token string">&quot;hash2&quot;</span>, <span class="token string">&quot;k2&quot;</span>, <span class="token string">&quot;k3&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 批量取出&quot;hash2&quot;的key-k2 k3对应的value --方式1</span>
print<span class="token punctuation">(</span>r.hmget<span class="token punctuation">(</span><span class="token string">&quot;hash2&quot;</span>, <span class="token punctuation">[</span><span class="token string">&quot;k2&quot;</span>, <span class="token string">&quot;k3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">))</span>  <span class="token comment"># 批量取出&quot;hash2&quot;的key-k2 k3对应的value --方式2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>3.取出所有的键值对</strong>
hgetall(name)
获取name对应hash的所有键值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>4.得到所有键值对的格式 hash长度</strong>
hlen(name)
获取name对应的hash中键值对的个数</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hlen<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>5.得到所有的keys（类似字典的取所有keys）</strong>
hkeys(name)
获取name对应的hash中所有的key的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hkeys<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>6.得到所有的value（类似字典的取所有value）</strong>
hvals(name)
获取name对应的hash中所有的value的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hvals<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>7.判断成员是否存在（类似字典的in）</strong>
hexists(name, key)
检查name对应的hash是否存在当前传入的key</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hexists<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k4&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># False 不存在</span>
print<span class="token punctuation">(</span>r.hexists<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k1&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># True 存在</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>8.删除键值对</strong>
hdel(name,*keys)
将name对应的hash中指定key的键值对删除</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
r.hset<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k2&quot;</span>, <span class="token string">&quot;v222&quot;</span><span class="token punctuation">)</span>   <span class="token comment"># 修改已有的key k2</span>
r.hset<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k11&quot;</span>, <span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span>   <span class="token comment"># 新增键值对 k11</span>
r.hdel<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span>    <span class="token comment"># 删除一个键值对</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>9.自增自减整数(将key对应的value--整数 自增1或者2，或者别的整数 负数就是自减)</strong>
hincrby(name, key, amount=1)
自增name对应的hash中的指定key的值，不存在则创建key=amount
参数：
name，redis中的name
key， hash对应的key
amount，自增数（整数）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.hset<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k3&quot;</span>, <span class="token number">123</span><span class="token punctuation">)</span>
r.hincrby<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k3&quot;</span>, <span class="token assign-left variable">amount</span><span class="token operator">=</span>-1<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
r.hincrby<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k4&quot;</span>, <span class="token assign-left variable">amount</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 不存在的话，value默认就是1</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>10.自增自减浮点数(将key对应的value--浮点数 自增1.0或者2.0，或者别的浮点数 负数就是自减)</strong>
hincrbyfloat(name, key, amount=1.0)
自增name对应的hash中的指定key的值，不存在则创建key=amount
参数：
name，redis中的name
key， hash对应的key
amount，自增数（浮点数）
自增name对应的hash中的指定key的值，不存在则创建key=amount</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.hset<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k5&quot;</span>, <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">)</span>
r.hincrbyfloat<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k5&quot;</span>, <span class="token assign-left variable">amount</span><span class="token operator">=</span>-1.0<span class="token punctuation">)</span>    <span class="token comment"># 已经存在，递减-1.0</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
r.hincrbyfloat<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span>, <span class="token string">&quot;k6&quot;</span>, <span class="token assign-left variable">amount</span><span class="token operator">=</span>-1.0<span class="token punctuation">)</span>    <span class="token comment"># 不存在，value初始值是-1.0 每次递减1.0</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>11.取值查看--分片读取</strong>
hscan(name, cursor=0, match=None, count=None)
增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而放置内存被撑爆
参数：
name，redis的name
cursor，游标（基于游标分批取获取数据）
match，匹配指定key，默认None 表示所有的key
count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数
如：
第一次：cursor1, data1 = r.hscan('xx', cursor=0, match=None, count=None)
第二次：cursor2, data1 = r.hscan('xx', cursor=cursor1, match=None, count=None)
...
直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hscan<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>12.hscan_iter(name, match=None, count=None)</strong>
利用yield封装hscan创建生成器，实现分批去redis中获取数据
参数：
match，匹配指定key，默认None 表示所有的key
count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数
如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">item</span> <span class="token keyword">in</span> r.hscan_iter<span class="token punctuation">(</span><span class="token string">'hash1'</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.hscan_iter<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>    <span class="token comment"># 生成器内存地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_5、redis基本命令-list"><a href="#_5、redis基本命令-list" class="header-anchor">#</a> 5、redis基本命令 list</h2> <p><strong>1.增加（类似于list的append，只是这里是从左边新增加）--没有就新建</strong>
lpush(name,values)
在name对应的list中添加元素，每个新的元素都添加到列表的最左边
如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>r<span class="token punctuation">.</span>lpush<span class="token punctuation">(</span><span class="token string">&quot;list1&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>lrange<span class="token punctuation">(</span><span class="token string">'list1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>保存顺序为: 33,22,11</p> <p>扩展：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.rpush<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">11</span>, <span class="token number">22</span>, <span class="token number">33</span><span class="token punctuation">)</span>  <span class="token comment"># 表示从右向左操作</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, <span class="token number">3</span><span class="token punctuation">))</span>  <span class="token comment"># 切片取出值，范围是索引号0-3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>2.增加（从右边增加）--没有就新建</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.rpush<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">44</span>, <span class="token number">55</span>, <span class="token number">66</span><span class="token punctuation">)</span>    <span class="token comment"># 在列表的右边，依次添加44,55,66</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span> <span class="token comment"># 切片取出值，范围是索引号0到-1(最后一个元素)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>3.往已经有的name的列表的左边添加元素，没有的话无法创建</strong>
lpushx(name,value)
在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边
更多：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.lpushx<span class="token punctuation">(</span><span class="token string">&quot;list10&quot;</span>, <span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment"># 这里list10不存在</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">&quot;list10&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 0</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list10&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>  <span class="token comment"># []</span>
r.lpushx<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">77</span><span class="token punctuation">)</span>   <span class="token comment"># 这里&quot;list2&quot;之前已经存在，往列表最左边添加一个元素，一次只能添加一个</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span> <span class="token comment"># 切片取出值，范围是索引号0到-1(最后一个元素</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>4.往已经有的name的列表的右边添加元素，没有的话无法创建</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.rpushx<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">99</span><span class="token punctuation">)</span>   <span class="token comment"># 这里&quot;foo_list1&quot;之前已经存在，往列表最右边添加一个元素，一次只能添加一个</span>
print<span class="token punctuation">(</span>r.llen<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 列表长度</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span> <span class="token comment"># 切片取出值，范围是索引号0到-1(最后一个元素)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>5.新增（固定索引号位置插入元素）</strong>
linsert(name, where, refvalue, value))
在name对应的列表的某一个值前或后插入一个新值
参数：
name，redis的name
where，BEFORE或AFTER
refvalue，标杆值，即：在它前后插入数据
value，要插入的数据</p> <div class="language-objectivec line-numbers-mode"><pre class="language-objectivec"><code>r<span class="token punctuation">.</span><span class="token function">linsert</span><span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;before&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00&quot;</span><span class="token punctuation">)</span>   # 往列表中左边第一个出现的元素<span class="token string">&quot;11&quot;</span>前插入元素<span class="token string">&quot;00&quot;</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   # 切片取出值，范围是索引号<span class="token number">0</span><span class="token operator">-</span>最后一个元素
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>6.修改（指定索引号进行修改）</strong>
r.lset(name, index, value)
对name对应的list中的某一个索引位置重新赋值
参数：
name，redis的name
index，list的索引位置
value，要设置的值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.lset<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -11<span class="token punctuation">)</span>    <span class="token comment"># 把索引号是0的元素修改成-11</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>7.删除（指定值进行删除）</strong>
r.lrem(name, value, num)
在name对应的list中删除指定的值
参数：
name，redis的name
value，要删除的值
num， num=0，删除列表中所有的指定值；
num=2,从前到后，删除2个； num=1,从前到后，删除左边第1个
num=-2,从后向前，删除2个</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.lrem<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token string">&quot;11&quot;</span>, <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># 将列表中左边第一次出现的&quot;11&quot;删除</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
r.lrem<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token string">&quot;99&quot;</span>, -1<span class="token punctuation">)</span>    <span class="token comment"># 将列表中右边第一次出现的&quot;99&quot;删除</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
r.lrem<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token string">&quot;22&quot;</span>, <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token comment"># 将列表中所有的&quot;22&quot;删除</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>8.删除并返回</strong>
lpop(name)
在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素
更多：
rpop(name) 表示从右向左操作</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.lpop<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">)</span>    <span class="token comment"># 删除列表最左边的元素，并且返回删除的元素</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
r.rpop<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span><span class="token punctuation">)</span>    <span class="token comment"># 删除列表最右边的元素，并且返回删除的元素</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>9.删除索引之外的值</strong>
ltrim(name, start, end)
在name对应的列表中移除没有在start-end索引之间的值
参数：
name，redis的name
start，索引的起始位置
end，索引结束位置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.ltrim<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token comment"># 删除索引号是0-2之外的元素，值保留索引号是0-2的元素</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>10.取值（根据索引号取值）</strong>
lindex(name, index)
在name对应的列表中根据索引获取列表元素</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.lindex<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span><span class="token punctuation">))</span>  <span class="token comment"># 取出索引号是0的值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>11.移动  元素从一个列表移动到另外一个列表</strong>
rpoplpush(src, dst)
从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边
参数：
src，要取数据的列表的name
dst，要添加数据的列表的name</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.rpoplpush<span class="token punctuation">(</span><span class="token string">&quot;list1&quot;</span>, <span class="token string">&quot;list2&quot;</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>12.移动  元素从一个列表移动到另外一个列表 可以设置超时</strong>
brpoplpush(src, dst, timeout=0)
从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧
参数：
src，取出并要移除元素的列表对应的name
dst，要插入元素的列表对应的name
timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.brpoplpush<span class="token punctuation">(</span><span class="token string">&quot;list1&quot;</span>, <span class="token string">&quot;list2&quot;</span>, <span class="token assign-left variable">timeout</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>13.一次移除多个列表</strong>
blpop(keys, timeout)
将多个列表排列，按照从左到右去pop对应列表的元素
参数：
keys，redis的name的集合
timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞
更多：
r.brpop(keys, timeout)  同blpop，将多个列表排列,按照从右像左去移除各个列表内的元素</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>r<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;list10&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;list11&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean constant">True</span><span class="token punctuation">:</span>
    r<span class="token punctuation">.</span><span class="token function">blpop</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;list10&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;list11&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;list10&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;list11&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>14.自定义增量迭代</strong>
由于redis类库中没有提供对列表元素的增量迭代，如果想要循环name对应的列表的所有元素，那么就需要：</p> <ol><li>获取name对应的所有列表</li> <li>循环列表</li></ol> <p>但是，如果列表非常大，那么就有可能在第一步时就将程序的内容撑爆，所有有必要自定义一个增量迭代的功能：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">list_iter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    自定义redis列表增量迭代
    :param name: redis中的name，即：迭代name对应的列表
    :return: yield 返回 列表元素
    &quot;&quot;&quot;</span>
    list_count <span class="token operator">=</span> r<span class="token punctuation">.</span>llen<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>list_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> r<span class="token punctuation">.</span>lindex<span class="token punctuation">(</span>name<span class="token punctuation">,</span> index<span class="token punctuation">)</span>

<span class="token comment"># 使用</span>
<span class="token keyword">for</span> item <span class="token keyword">in</span> list_iter<span class="token punctuation">(</span><span class="token string">'list2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 遍历这个列表</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_6、redis基本命令-set"><a href="#_6、redis基本命令-set" class="header-anchor">#</a> 6、redis基本命令 set</h2> <p><strong>1.新增</strong>
sadd(name,values)
name对应的集合中添加元素</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.sadd<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token number">33</span>, <span class="token number">44</span>, <span class="token number">55</span>, <span class="token number">66</span><span class="token punctuation">)</span>  <span class="token comment"># 往集合中添加元素</span>
print<span class="token punctuation">(</span>r.scard<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 集合的长度是4</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 获取集合中所有的成员</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>2.获取元素个数 类似于len</strong>
scard(name)
获取name对应的集合中元素个数</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.scard<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>  <span class="token comment"># 集合的长度是4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3.获取集合中所有的成员</strong>
smembers(name)
获取name对应的集合的所有成员</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 获取集合中所有的成员</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>获取集合中所有的成员--元组形式</strong>
sscan(name, cursor=0, match=None, count=None)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.sscan<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>获取集合中所有的成员--迭代器的方式</strong>
sscan_iter(name, match=None, count=None)
同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> r.sscan_iter<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>4.差集</strong>
sdiff(keys, *args)
在第一个name对应的集合中且不在其他name对应的集合的元素集合</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.sadd<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span>, <span class="token number">11</span>, <span class="token number">22</span>, <span class="token number">33</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 获取集合中所有的成员</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.sdiff<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 在集合set1但是不在集合set2中</span>
print<span class="token punctuation">(</span>r.sdiff<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span>, <span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 在集合set2但是不在集合set1中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>5.差集--差集存在一个新的集合中</strong>
sdiffstore(dest, keys, *args)
获取第一个name对应的集合中且不在其他name对应的集合，再将其新加入到dest对应的集合中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.sdiffstore<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span>, <span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span><span class="token punctuation">)</span>    <span class="token comment"># 在集合set1但是不在集合set2中</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 获取集合3中所有的成员</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>6.交集</strong>
sinter(keys, *args)
获取多一个name对应集合的交集</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.sinter<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span> <span class="token comment"># 取2个集合的交集</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>7.交集--交集存在一个新的集合中</strong>
sinterstore(dest, keys, *args)
获取多一个name对应集合的并集，再将其加入到dest对应的集合中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.sinterstore<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span>, <span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span> <span class="token comment"># 取2个集合的交集</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>并集</strong>
sunion(keys, *args)
获取多个name对应的集合的并集</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.sunion<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span> <span class="token comment"># 取2个集合的并集</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>并集--并集存在一个新的集合</strong>
sunionstore(dest,keys, *args)
获取多一个name对应的集合的并集，并将结果保存到dest对应的集合中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.sunionstore<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span>, <span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span> <span class="token comment"># 取2个集合的并集</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>8.判断是否是集合的成员 类似in</strong>
sismember(name, value)
检查value是否是name对应的集合的成员，结果为True和False</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.sismember<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token number">33</span><span class="token punctuation">))</span>  <span class="token comment"># 33是集合的成员</span>
print<span class="token punctuation">(</span>r.sismember<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token number">23</span><span class="token punctuation">))</span>  <span class="token comment"># 23不是集合的成员</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>9.移动</strong>
smove(src, dst, value)
将某个成员从一个集合中移动到另外一个集合</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.smove<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span>, <span class="token string">&quot;set2&quot;</span>, <span class="token number">44</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>10.删除--随机删除并且返回被删除值</strong>
spop(name)
从集合移除一个成员，并将其返回,说明一下，集合是无序的，所有是随机删除的</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.spop<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 这个删除的值是随机删除的，集合是无序的</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>11.删除--指定值删除</strong>
srem(name, values)
在name对应的集合中删除某些值</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.srem<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span>, <span class="token number">11</span><span class="token punctuation">))</span>   <span class="token comment"># 从集合中删除指定值 11</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set2&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_7、redis基本命令-有序set"><a href="#_7、redis基本命令-有序set" class="header-anchor">#</a> 7、redis基本命令 有序set</h2> <p>Set操作，Set集合就是不允许重复的列表，本身是无序的
有序集合，在集合的基础上，为每元素排序；元素的排序需要根据另外一个值来进行比较，
所以，对于有序集合，每一个元素有两个值，即：值和分数，分数专门用来做排序。</p> <p><strong>1.新增</strong>
zadd(name, *args, **kwargs)
在name对应的有序集合中添加元素
如：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>

r<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">&quot;zset1&quot;</span><span class="token punctuation">,</span> n1<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> n2<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">&quot;zset2&quot;</span><span class="token punctuation">,</span> <span class="token string">'m1'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'m2'</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">&quot;zset1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 集合长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">&quot;zset2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 集合长度</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zrange<span class="token punctuation">(</span><span class="token string">&quot;zset1&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># 获取有序集合中所有元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>zrange<span class="token punctuation">(</span><span class="token string">&quot;zset2&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># 获取有序集合中所有元素和分数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>2.获取有序集合元素个数 类似于len</strong>
zcard(name)
获取name对应的有序集合元素的数量</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.zcard<span class="token punctuation">(</span><span class="token string">&quot;zset1&quot;</span><span class="token punctuation">))</span> <span class="token comment"># 集合长度</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3.获取有序集合的所有元素</strong>
r.zrange( name, start, end, desc=False, withscores=False, score_cast_func=float)
按照索引范围获取name对应的有序集合的元素
参数：
name，redis的name
start，有序集合索引起始位置（非分数）
end，有序集合索引结束位置（非分数）
desc，排序规则，默认按照分数从小到大排序
withscores，是否获取元素的分数，默认只获取元素的值
score_cast_func，对分数进行数据转换的函数</p> <p>3-1 从大到小排序(同zrange，集合是从大到小排序的)
zrevrange(name, start, end, withscores=False, score_cast_func=float)</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset1&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 只获取元素，不显示分数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset1&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean constant">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># 获取有序集合中所有元素和分数,分数倒序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>3-2 按照分数范围获取name对应的有序集合的元素</strong>
zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   element <span class="token operator">=</span> <span class="token single-quoted-string string">'n'</span> <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
   r<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrangebyscore</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># # 在分数是15-25之间，取出符合条件的元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrangebyscore</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean constant">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 在分数是12-22之间，取出符合条件的元素（带分数）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>3-3 按照分数范围获取有序集合的元素并排序（默认从大到小排序）</strong>
zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrevrangebyscore</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean constant">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># 在分数是22-11之间，取出符合条件的元素 按照分数倒序</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3-4 获取所有元素--默认按照分数顺序排序</strong>
zscan(name, cursor=0, match=None, count=None, score_cast_func=float)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.zscan<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3-5 获取所有元素--迭代器</strong>
zscan_iter(name, match=None, count=None,score_cast_func=float)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> r.zscan_iter<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span><span class="token punctuation">)</span>: <span class="token comment"># 遍历迭代器</span>
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>4.zcount(name, min, max)</strong>
获取name对应的有序集合中分数 在 [min,max] 之间的个数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean constant">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zcount</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>5.自增</strong>
zincrby(name, value, amount)
自增name对应的有序集合的 name 对应的分数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>r<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;n2&quot;</span><span class="token punctuation">,</span> amount<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token shell-comment comment"># 每次将n2的分数自增2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;zset3&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean constant">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>6.获取值的索引号</strong>
zrank(name, value)
获取某个值在 name对应的有序集合中的索引（从 0 开始）
更多：
zrevrank(name, value)，从大到小排序</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.zrank<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token string">&quot;n1&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># n1的索引号是0 这里按照分数顺序（从小到大）</span>
print<span class="token punctuation">(</span>r.zrank<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token string">&quot;n6&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># n6的索引号是1</span>

print<span class="token punctuation">(</span>r.zrevrank<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token string">&quot;n1&quot;</span><span class="token punctuation">))</span>    <span class="token comment"># n1的索引号是29 这里安照分数倒序（从大到小）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>7.删除--指定值删除</strong>
zrem(name, values)
删除name对应的有序集合中值是values的成员</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.zrem<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token string">&quot;n3&quot;</span><span class="token punctuation">)</span>   <span class="token comment"># 删除有序集合中的元素n3 删除单个</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>8.删除--根据排行范围删除，按照索引号来删除</strong>
zremrangebyrank(name, min, max)
根据排行范围删除</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.zremrangebyrank<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token number">0</span>, <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 删除有序集合中的索引号是0, 1的元素</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>9.删除--根据分数范围删除</strong>
zremrangebyscore(name, min, max)
根据分数范围删除</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.zremrangebyscore<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token number">11</span>, <span class="token number">22</span><span class="token punctuation">)</span>   <span class="token comment"># 删除有序集合中的分数是11-22的元素</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>10.获取值对应的分数</strong>
zscore(name, value)
获取name对应有序集合中 value 对应的分数</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.zscore<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token string">&quot;n27&quot;</span><span class="token punctuation">))</span>   <span class="token comment"># 获取元素n27对应的分数27</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_8、其他常用操作"><a href="#_8、其他常用操作" class="header-anchor">#</a> 8、其他常用操作</h2> <p><strong>1.删除</strong>
delete(*names)
根据删除redis中的任意数据类型（string、hash、list、set、有序set）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.delete<span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 删除key为gender的键值对</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>2.检查名字是否存在</strong>
exists(name)
检测redis的name是否存在，存在就是True，False 不存在</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.exists<span class="token punctuation">(</span><span class="token string">&quot;zset1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>3.模糊匹配</strong>
keys(pattern='<em>') 根据模型获取redis的name 更多： KEYS * 匹配数据库中所有 key 。 KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。 KEYS h</em>llo 匹配 hllo 和 heeeeello 等。
KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.keys<span class="token punctuation">(</span><span class="token string">&quot;foo*&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>4.设置超时时间</strong>
expire(name ,time)
为某个redis的某个name设置超时时间</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.lpush<span class="token punctuation">(</span><span class="token string">&quot;list5&quot;</span>, <span class="token number">11</span>, <span class="token number">22</span><span class="token punctuation">)</span>
r.expire<span class="token punctuation">(</span><span class="token string">&quot;list5&quot;</span>, <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list5&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
time.sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list5&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>5.重命名</strong>
rename(src, dst)
对redis的name重命名</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>r.lpush<span class="token punctuation">(</span><span class="token string">&quot;list5&quot;</span>, <span class="token number">11</span>, <span class="token number">22</span><span class="token punctuation">)</span>
r.rename<span class="token punctuation">(</span><span class="token string">&quot;list5&quot;</span>, <span class="token string">&quot;list5-1&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>6.随机获取name</strong>
randomkey()
随机获取一个redis的name（不删除）</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.randomkey<span class="token punctuation">(</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>7.获取类型</strong>
type(name)
获取name对应值的类型</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">(</span><span class="token string">&quot;set1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">(</span><span class="token string">&quot;hash2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>8.查看所有元素</strong>
scan(cursor=0, match=None, count=None)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.hscan<span class="token punctuation">(</span><span class="token string">&quot;hash2&quot;</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.sscan<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.zscan<span class="token punctuation">(</span><span class="token string">&quot;zset2&quot;</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.getrange<span class="token punctuation">(</span><span class="token string">&quot;foo1&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.lrange<span class="token punctuation">(</span><span class="token string">&quot;list2&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.smembers<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.zrange<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span>, <span class="token number">0</span>, -1<span class="token punctuation">))</span>
print<span class="token punctuation">(</span>r.hgetall<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>9.查看所有元素--迭代器</strong>
scan_iter(match=None, count=None)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> r.hscan_iter<span class="token punctuation">(</span><span class="token string">&quot;hash1&quot;</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> r.sscan_iter<span class="token punctuation">(</span><span class="token string">&quot;set3&quot;</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> r.zscan_iter<span class="token punctuation">(</span><span class="token string">&quot;zset3&quot;</span><span class="token punctuation">)</span>:
    print<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>other 方法</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>print<span class="token punctuation">(</span>r.get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">))</span>    <span class="token comment"># 查询key为name的值</span>
r.delete<span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 删除key为gender的键值对</span>
print<span class="token punctuation">(</span>r.keys<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token comment"># 查询所有的Key</span>
print<span class="token punctuation">(</span>r.dbsize<span class="token punctuation">(</span><span class="token punctuation">))</span>   <span class="token comment"># 当前redis包含多少条数据</span>
r.save<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 执行&quot;检查点&quot;操作，将数据写回磁盘。保存时阻塞</span>
<span class="token comment"># r.flushdb()        # 清空r中的所有数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>管道（pipeline）</strong>
redis默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，
如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline 是原子性操作。</p> <p>管道（pipeline）是redis在提供单个请求中缓冲多条服务器命令的基类的子类。它通过减少服务器-客户端之间反复的TCP数据库包，从而大大提高了执行批量命令的功能。</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token keyword">import</span> redis
<span class="token keyword">import</span> time

pool <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">ConnectionPool</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> decode_responses<span class="token operator">=</span>True<span class="token punctuation">)</span>
r <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">Redis</span><span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>

# pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>False<span class="token punctuation">)</span>    # 默认的情况下，管道里执行的命令可以保证执行的原子性，执行pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>False<span class="token punctuation">)</span>可以禁用这一特性。
# pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span>True<span class="token punctuation">)</span>
pipe <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> # 创建一个管道

pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'jack'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'sb'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'faz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">)</span>    # 如果num不存在则vaule为<span class="token number">1</span>，如果存在，则value自增<span class="token number">1</span>
pipe<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>管道的命令可以写在一起，如：</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>pipe<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'faz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/Python魔术方法.html" class="prev">
        介绍
      </a></span> <span class="next"><a href="/python/动态加载模块和类.html">
        python - 动态加载模块和类
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1b94221b.js" defer></script><script src="/assets/js/2.60568d92.js" defer></script><script src="/assets/js/14.ab694e76.js" defer></script>
  </body>
</html>
