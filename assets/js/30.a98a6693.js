(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{369:function(t,a,r){"use strict";r.r(a);var s=r(43),v=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"数据结构与对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据结构与对象"}},[t._v("#")]),t._v(" 数据结构与对象")]),t._v(" "),r("h2",{attrs:{id:"跳跃表"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跳跃表"}},[t._v("#")]),t._v(" 跳跃表")]),t._v(" "),r("p",[t._v("​\t\t跳跃表是一种"),r("strong",[t._v("有序数据结构")]),t._v("，通过每个节点中维持多个指向其它节点的指针，从而实现快速访问节点的目的。")]),t._v(" "),r("p",[t._v("​\t\tRedis使用跳跃表作为有序集合键的底层实现之一，如果一个"),r("strong",[t._v("有序集合包含的元素数量比较多，又或者有序集合中元素的成员是比较长的字符串时")]),t._v("，Redis就会使用跳跃表来作为有序集合键的底层实现。")]),t._v(" "),r("h3",{attrs:{id:"跳跃表实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跳跃表实现"}},[t._v("#")]),t._v(" 跳跃表实现")]),t._v(" "),r("p",[t._v("​\t\t跳跃表由"),r("code",[t._v("zskiplistNode")]),t._v("和"),r("code",[t._v("zskiplist")]),t._v("两个结构定义，其中"),r("code",[t._v("zskiplistNode")]),t._v("标识跳跃表节点，"),r("code",[t._v("zskiplist")]),t._v("用于保存跳跃表节点的相关信息，比如"),r("strong",[t._v("节点数量，指向表头的指针和表尾节点的指针等")]),t._v("。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572239006090.png",alt:"1572239006090"}})]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[t._v("上图最左边的是`zskiplist`结构，包括一下属性\n")])])]),r("ul",[r("li",[t._v("header：指向跳跃表的"),r("strong",[t._v("表头节点")]),t._v("。")]),t._v(" "),r("li",[t._v("tail：指向跳跃表的"),r("strong",[t._v("表尾节点")]),t._v("。")]),t._v(" "),r("li",[t._v("level：记录目前跳跃表内，"),r("strong",[t._v("层数最大的那个节点的层数")]),t._v("。")]),t._v(" "),r("li",[t._v("length：记录跳跃表的长度，也就是"),r("strong",[t._v("跳跃表目前包含节点的数量")]),t._v("。")])]),t._v(" "),r("p",[t._v("​\t位于"),r("code",[t._v("zskiplist")]),t._v("右边的结构是"),r("code",[t._v("zskiplistNode")]),t._v("，包括以下属性")]),t._v(" "),r("ul",[r("li",[t._v("层（level）节点中的L1，L2等，每个层都有两个属性："),r("strong",[t._v("前进指针和跨度")]),t._v("。前进指针用于访问位于表尾方向的其他节点，跨度则记录了前进指针所指向节点和当前节点的距离。（图中带数字的箭头就代表跨度，指向就代表前进指针）")]),t._v(" "),r("li",[t._v("后退（backward）节点中用"),r("code",[t._v("BW")]),t._v("标记节点的后退指针，指向位于当前节点的前一个节点。"),r("strong",[t._v("表尾向表头遍历时使用")]),t._v("。")]),t._v(" "),r("li",[t._v("分值（score）1.0，2.0等，按"),r("strong",[t._v("从小到大排序")])]),t._v(" "),r("li",[t._v("成员对象（obj）o1，o2等")])]),t._v(" "),r("h3",{attrs:{id:"跳跃表节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跳跃表节点"}},[t._v("#")]),t._v(" 跳跃表节点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572239724191.png",alt:"1572239724191"}})]),t._v(" "),r("h3",{attrs:{id:"跳跃表重点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跳跃表重点"}},[t._v("#")]),t._v(" 跳跃表重点")]),t._v(" "),r("ul",[r("li",[t._v("跳跃表是"),r("strong",[t._v("有序集合")]),t._v("的底层实现之一。")]),t._v(" "),r("li",[t._v("Redis的跳跃表实现由"),r("code",[t._v("zskiplist")]),t._v("和"),r("code",[t._v("azskiplistNode")]),t._v("两个结构组成，其中"),r("code",[t._v("zskiplist")]),t._v("用于保存跳跃表信息（比如表头节点、表尾节点、长度），而"),r("code",[t._v("zskiplistNode")]),t._v("用于表示跳跃表节点。")]),t._v(" "),r("li",[t._v("每个跳跃表节点的层高都是"),r("strong",[t._v("1到32之间的随机数")]),t._v("。")]),t._v(" "),r("li",[t._v("同一跳跃表中，多个节点可以包含相同的分值，但"),r("strong",[t._v("每个节点的成员对象必须是唯一的")]),t._v("。")]),t._v(" "),r("li",[t._v("跳跃表中的节点按照分值大小排序，当分值相同时，节点按照成员对象的大小进行排序。")])]),t._v(" "),r("h2",{attrs:{id:"整数集合"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#整数集合"}},[t._v("#")]),t._v(" 整数集合")]),t._v(" "),r("p",[t._v("​\t\t整数集合（intset）时集合键的底层实现之一，"),r("strong",[t._v("当一个集合只包含整数值元素，并且这个集合的元素数量不多")]),t._v("时，Redis就会使用证书集合作为集合键的底层实现。")]),t._v(" "),r("h3",{attrs:{id:"整数集合实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#整数集合实现"}},[t._v("#")]),t._v(" 整数集合实现")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572241241650.png",alt:"1572241241650"}})]),t._v(" "),r("p",[t._v("​\t\t"),r("code",[t._v("contents")]),t._v("数组的元素按从小到大有序排列，并且元素不重复。")]),t._v(" "),r("h3",{attrs:{id:"升级"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#升级"}},[t._v("#")]),t._v(" 升级")]),t._v(" "),r("p",[t._v("​\t\t为整数集合添加元素时，需要先进行升级（upgrade），升级集合并且添加新元素分为三步进行：")]),t._v(" "),r("ul",[r("li",[t._v("根据新元素的类型，扩展集合空间，为新元素分配空间。")]),t._v(" "),r("li",[t._v("将底层数组的所有元素类型都转换成新元素的类形，并将类型转换后的元素放到正确的位置上，并保持有序性不变。")]),t._v(" "),r("li",[t._v("将新元素添加到底层数组里面。")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572265936572.png",alt:"1572265936572"}})]),t._v(" "),r("p",[t._v("​\t\t升级的好处：提升整数集合的灵活性；尽可能地节约内存。")]),t._v(" "),r("p",[t._v("​\t\t整数集合不能降级，就算比较大的元素删除，也不能降级。")]),t._v(" "),r("h3",{attrs:{id:"整数集合重点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#整数集合重点"}},[t._v("#")]),t._v(" 整数集合重点")]),t._v(" "),r("ul",[r("li",[t._v("整数集合是集合键的底层实现之一")]),t._v(" "),r("li",[t._v("整数集合底层实现是数组，这个数组以有序、无重复的方式保存集合元素，在有需要时，会根据新元素的类型来改变数组的类型")]),t._v(" "),r("li",[t._v("升级提升了整数集合的灵活性；尽可能地节约内存，"),r("strong",[t._v("不支持降级")])])]),t._v(" "),r("h2",{attrs:{id:"压缩列表"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#压缩列表"}},[t._v("#")]),t._v(" 压缩列表")]),t._v(" "),r("p",[t._v("​\t\t压缩列表（ziplist）是"),r("strong",[t._v("列表键和哈希键")]),t._v("的底层实现之一。当一个"),r("strong",[t._v("列表键只包含少量列表项")]),t._v("，并且每个列表项要么就是小整数值，要么就是长度比较短的字符串，那么Redis就会使用压缩列表来做列表键的底层实现。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572313854406.png",alt:"1572313854406"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572313861381.png",alt:"1572313861381"}})]),t._v(" "),r("h3",{attrs:{id:"压缩列表的构成"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#压缩列表的构成"}},[t._v("#")]),t._v(" 压缩列表的构成")]),t._v(" "),r("p",[t._v("​\t\t压缩列表是Redis为节约内存开发的。一个压缩列表包含任意多个节点（entry），"),r("strong",[t._v("每个节点可以保存一个字节数组或者一个整数值")]),t._v("。")]),t._v(" "),r("p",[t._v("​\t\t压缩列表的组成部分如下图：")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572314108323.png",alt:"1572314108323"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572314016646.png",alt:"1572314016646"}})]),t._v(" "),r("p",[t._v("​\t\t压缩列表示例")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572314179766.png",alt:"1572314179766"}})]),t._v(" "),r("h3",{attrs:{id:"压缩列表的节点构成"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#压缩列表的节点构成"}},[t._v("#")]),t._v(" 压缩列表的节点构成")]),t._v(" "),r("p",[t._v("​\t\t每个压缩列表的节点可以保存一个字节数组或者一个整数值，每个Entry的构成如下图")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572314328531.png",alt:"1572314328531"}})]),t._v(" "),r("ul",[r("li",[r("p",[t._v("previous_entry_length: 记录了压缩列表中前一个节点的长度。（该属性的长度可以是1-5个字节）")]),t._v(" "),r("ul",[r("li",[t._v("如果前一个节点的长度"),r("strong",[t._v("小于")]),t._v("254字节，那么previous_entry_length属性要用"),r("strong",[t._v("1字节")]),t._v("长的空间来保存这个长度值")]),t._v(" "),r("li",[t._v("如果前一个节点的长度"),r("strong",[t._v("大于等于")]),t._v("254字节，那么previous_entry_length属性要用"),r("strong",[t._v("5字节")]),t._v("长的空间来保存这个长度值")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572314620905.png",alt:"1572314620905"}})]),t._v(" "),r("p",[r("strong",[t._v("因为当前节点记录了前一个节点的长度，所以可以根据当前节点的起始地址来计算出前一个节点的起始地址。")])]),t._v(" "),r("p",[t._v("压缩列表从表尾向表头的遍历操作就是使用这一原理实现的。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572314915429.png",alt:"1572314915429"}})])]),t._v(" "),r("li",[r("p",[t._v("encoding：记录了节点的content属性所保存数据的类型以及长度")])]),t._v(" "),r("li",[r("p",[t._v("content：保存节点的值")])])]),t._v(" "),r("h3",{attrs:{id:"连锁更新"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#连锁更新"}},[t._v("#")]),t._v(" 连锁更新")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572315284196.png",alt:"1572315284196"}})]),t._v(" "),r("p",[t._v("​\t\te1的"),r("code",[t._v("previous_entry_length")]),t._v("只有一个字节，为了让e1能记录新节点的长度，则需要对e1进行扩展，让"),r("code",[t._v("previous_entry_length")]),t._v("扩展至5个字节。")]),t._v(" "),r("p",[t._v("​\t\t从而e1的扩展也引发了e2，以及后续节点的扩展。")]),t._v(" "),r("h3",{attrs:{id:"重点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("ul",[r("li",[t._v("压缩列表是一种为节约内存而开发的顺序性数据结构")]),t._v(" "),r("li",[t._v("压缩列表被用作列表键和哈希键的底层实现之一。")]),t._v(" "),r("li",[t._v("压缩列表可以包含多个节点， 每个节点可以保存一个字节数组或者一个整数值。")]),t._v(" "),r("li",[t._v("添加新节点到压缩列表，或者从压缩列表中删除节点，可能会引发连锁更新。")])]),t._v(" "),r("h2",{attrs:{id:"对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#对象"}},[t._v("#")]),t._v(" 对象")]),t._v(" "),r("p",[t._v("​\t\tRedis用到的所有主要数据结构，比如简单动态字符串（SDS）、双端链表、字典、压缩列表、整数集合等。")]),t._v(" "),r("p",[t._v("​\t\tRedis没有直接使用这些数据结构来实现键值对数据库，而是基于这些数据结构创建了一个对象系统，包含："),r("strong",[t._v("字符串对象、列表对象、哈希对象、集合对象和有序集合对象")]),t._v("，每个对象都用到了至少一种上面的数据结构。")]),t._v(" "),r("h3",{attrs:{id:"对象的类型与编码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#对象的类型与编码"}},[t._v("#")]),t._v(" 对象的类型与编码")]),t._v(" "),r("p",[t._v("​\t\tRedis在数据库中新创建一个键值对时，我们至少会创建两个对象，一个对象用作键，一个对象用作值。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316295839.png",alt:"1572316295839"}})]),t._v(" "),r("h4",{attrs:{id:"类型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[t._v("#")]),t._v(" 类型")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316423487.png",alt:"1572316423487"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316451258.png",alt:"1572316451258"}})]),t._v(" "),r("h4",{attrs:{id:"编码和底层实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#编码和底层实现"}},[t._v("#")]),t._v(" 编码和底层实现")]),t._v(" "),r("p",[t._v("​\t\t对象的ptr指针指向对象的底层实现数据结构，而这些数据结构由对象的encoding属性决定。")]),t._v(" "),r("p",[t._v("​\t\tencoding属性记录了对象所使用的编码，也就是说这个对象使用了什么数据结构作为对象的底层实现。属性值对应下面代表中的常量")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316739222.png",alt:"1572316739222"}})]),t._v(" "),r("p",[t._v("​\t\t每种类型的对象都至少使用了两种不同的编码，下表列出每种类型的对象可以使用的编码。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316871040.png",alt:"1572316871040"}})]),t._v(" "),r("p",[t._v("​\t\t使用"),r("code",[t._v("OBJECT ENCODING")]),t._v("命令可以查看一个数据库键的值对象的编码")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316977765.png",alt:"1572316977765"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572316989578.png",alt:"1572316989578"}})]),t._v(" "),r("p",[t._v("​\t\tRedis可以根据不同场景来为一个对象设置不同的编码，从而优化对象在某场景下的效率：")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317091580.png",alt:"1572317091580"}})]),t._v(" "),r("h3",{attrs:{id:"字符串对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#字符串对象"}},[t._v("#")]),t._v(" 字符串对象")]),t._v(" "),r("p",[t._v("​\t\t字符串对象的编码可以是"),r("strong",[t._v("int、raw或者embstr")]),t._v("；")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317169117.png",alt:"1572317169117"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317238650.png",alt:"1572317238650"}})]),t._v(" "),r("p",[t._v("​\t\t执行命令")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317273146.png",alt:"1572317273146"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317288676.png",alt:"1572317288676"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317364854.png",alt:"1572317364854"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317372803.png",alt:"1572317372803"}})]),t._v(" "),r("p",[t._v("​\t\t"),r("strong",[t._v("embstr编码的字符串对象来保存短字符串值的好处")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317461821.png",alt:"1572317461821"}})]),t._v(" "),r("p",[t._v("​\t\t执行命令")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317506161.png",alt:"1572317506161"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572317512370.png",alt:"1572317512370"}})]),t._v(" "),r("h3",{attrs:{id:"列表对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#列表对象"}},[t._v("#")]),t._v(" 列表对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572359001363.png",alt:"1572359001363"}})]),t._v(" "),r("p",[t._v("若对象使用的是"),r("code",[t._v("ziplist")]),t._v("编码，那么这个键的值对象如下图：")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572359046917.png",alt:"1572359046917"}})]),t._v(" "),r("p",[r("code",[t._v("linkedlist")]),t._v("编码的列表对象使用了双端链表作为底层实现。每个双端链表节点（node）都保存了一个字符串对像，而每个字符串对象都保存了一个列表元素。")]),t._v(" "),r("p",[t._v("键的值对象如下图：")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572359411376.png",alt:"1572359411376"}})]),t._v(" "),r("h4",{attrs:{id:"编码转换"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#编码转换"}},[t._v("#")]),t._v(" 编码转换")]),t._v(" "),r("p",[t._v("列表对象使用"),r("code",[t._v("ziplist")]),t._v("编码的两个条件：")]),t._v(" "),r("ul",[r("li",[t._v("列表对象保存的"),r("strong",[t._v("所有字符串元素的长度都小于64字节")]),t._v("；")]),t._v(" "),r("li",[t._v("列表对象保存的"),r("strong",[t._v("元素数量小于512个")]),t._v("；不满足这两个条件的列表对象则使用"),r("code",[t._v("linkedlist")]),t._v("编码；")])]),t._v(" "),r("h3",{attrs:{id:"哈希对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#哈希对象"}},[t._v("#")]),t._v(" 哈希对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572402719567.png",alt:"1572402719567"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572402728122.png",alt:"1572402728122"}})]),t._v(" "),r("p",[t._v("执行命令")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572402912269.png",alt:"1572402912269"}})]),t._v(" "),r("p",[t._v("​\t\t"),r("code",[t._v("hashtable")]),t._v("编码的哈希对象使用"),r("strong",[t._v("字典")]),t._v("作为底层实现，哈希对象中的"),r("strong",[t._v("每个键值对都使用一个字典键值对来保存")]),t._v("：")]),t._v(" "),r("ul",[r("li",[t._v("字典的每个键都是一个字符串对象，对象中保存了键值对的键；")]),t._v(" "),r("li",[t._v("字典的每个值都是一个字符串对象，对象中保存了键值对的值；")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572403032532.png",alt:"1572403032532"}})]),t._v(" "),r("h4",{attrs:{id:"编码转换-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#编码转换-2"}},[t._v("#")]),t._v(" 编码转换")]),t._v(" "),r("p",[t._v("列表对象使用"),r("code",[t._v("ziplist")]),t._v("编码的两个条件：")]),t._v(" "),r("ul",[r("li",[t._v("列表对象保存的"),r("strong",[t._v("所有字符串元素的长度都小于64字节")]),t._v("；")]),t._v(" "),r("li",[t._v("列表对象保存的"),r("strong",[t._v("元素数量小于512个")]),t._v("；不满足这两个条件的哈希对象则使用"),r("code",[t._v("hashtable")]),t._v("编码；")])]),t._v(" "),r("h3",{attrs:{id:"集合对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#集合对象"}},[t._v("#")]),t._v(" 集合对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572403155250.png",alt:"1572403155250"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572403180263.png",alt:"1572403180263"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572403190660.png",alt:"1572403190660"}})]),t._v(" "),r("h4",{attrs:{id:"编码转换-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#编码转换-3"}},[t._v("#")]),t._v(" 编码转换")]),t._v(" "),r("p",[t._v("当集合对象同时满足以下两个条件时，对象使用"),r("code",[t._v("intset")]),t._v("编码；")]),t._v(" "),r("ul",[r("li",[t._v("集合对象保存的所有元素都是整数值；")]),t._v(" "),r("li",[t._v("集合对象保存的元素数量不超过512个；")])]),t._v(" "),r("p",[t._v("不满足这两个条件则要使用"),r("code",[t._v("hashtable")]),t._v("编码。")]),t._v(" "),r("h3",{attrs:{id:"有序集合对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#有序集合对象"}},[t._v("#")]),t._v(" 有序集合对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572407304574.png",alt:"1572407304574"}})]),t._v(" "),r("p",[t._v("执行代码")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572408103366.png",alt:"1572408103366"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572409206525.png",alt:"1572409206525"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572409320229.png",alt:"1572409320229"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572409591534.png",alt:"1572409591534"}})]),t._v(" "),r("p",[r("strong",[t._v("为什么有序集合要同时使用跳跃表和字典来实现")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572409654843.png",alt:"1572409654843"}})]),t._v(" "),r("h4",{attrs:{id:"编码转换-4"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#编码转换-4"}},[t._v("#")]),t._v(" 编码转换")]),t._v(" "),r("p",[t._v("当有序集合对象同时满足以下两个条件时，对象使用"),r("code",[t._v("ziplist")]),t._v("编码；")]),t._v(" "),r("ul",[r("li",[t._v("有序集合保存的元素数量小于128个；")]),t._v(" "),r("li",[t._v("有序集合保存的所有元素成员的长度都小于64字节；")])]),t._v(" "),r("p",[t._v("不满足上面两个条件的有序集合对象将使用"),r("code",[t._v("skiplist")]),t._v("编码；")]),t._v(" "),r("h3",{attrs:{id:"类型检查与命令多态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#类型检查与命令多态"}},[t._v("#")]),t._v(" 类型检查与命令多态")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572487992863.png",alt:"1572487992863"}})]),t._v(" "),r("h4",{attrs:{id:"类型检查的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#类型检查的实现"}},[t._v("#")]),t._v(" 类型检查的实现")]),t._v(" "),r("p",[t._v("​\t\t在执行一个类型特定的命令之前，Redis会先检查输入键的类型是否正确，然后在决定是否执行该命令。")]),t._v(" "),r("p",[t._v("​\t\t类型特定命令进行的类型检查时通过"),r("code",[t._v("redisObject")]),t._v("结构的"),r("code",[t._v("type")]),t._v("属性来实现的。")]),t._v(" "),r("h4",{attrs:{id:"多态命令的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#多态命令的实现"}},[t._v("#")]),t._v(" 多态命令的实现")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572488216213.png",alt:"1572488216213"}})]),t._v(" "),r("h3",{attrs:{id:"内存回收"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#内存回收"}},[t._v("#")]),t._v(" 内存回收")]),t._v(" "),r("p",[t._v("​\t\tRedis在对象系统中采用了引用计数的方式来跟踪每个对象的引用信息。从而对一些对象进行内存回收。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572496599272.png",alt:"1572496599272"}})]),t._v(" "),r("h3",{attrs:{id:"对象共享"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#对象共享"}},[t._v("#")]),t._v(" 对象共享")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572497062884.png",alt:"1572497062884"}})]),t._v(" "),r("p",[t._v("可以使用"),r("code",[t._v("object refcount")]),t._v("命令来查看某个键的值对象的引用计数。")]),t._v(" "),r("h3",{attrs:{id:"对象的空转时长"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#对象的空转时长"}},[t._v("#")]),t._v(" 对象的空转时长")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572498551986.png",alt:"1572498551986"}})]),t._v(" "),r("p",[t._v("可以使用"),r("code",[t._v("object idletime")]),t._v("命令打印给定键的空转时长")]),t._v(" "),r("h3",{attrs:{id:"重点-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-2"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572498734520.png",alt:"1572498734520"}})]),t._v(" "),r("h1",{attrs:{id:"单机数据库的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#单机数据库的实现"}},[t._v("#")]),t._v(" 单机数据库的实现")]),t._v(" "),r("h2",{attrs:{id:"数据库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据库"}},[t._v("#")]),t._v(" 数据库")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572499269018.png",alt:"1572499269018"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572499286370.png",alt:"1572499286370"}})]),t._v(" "),r("h3",{attrs:{id:"切换数据库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#切换数据库"}},[t._v("#")]),t._v(" 切换数据库")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572499670742.png",alt:"1572499670742"}})]),t._v(" "),r("h3",{attrs:{id:"设置键的生存时间或过期时间"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#设置键的生存时间或过期时间"}},[t._v("#")]),t._v(" 设置键的生存时间或过期时间")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572502743226.png",alt:"1572502743226"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572502931275.png",alt:"1572502931275"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572503073008.png",alt:"1572503073008"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572503103903.png",alt:"1572503103903"}})]),t._v(" "),r("h3",{attrs:{id:"过期键删除策略"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#过期键删除策略"}},[t._v("#")]),t._v(" 过期键删除策略")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572518687978.png",alt:"1572518687978"}})]),t._v(" "),r("h4",{attrs:{id:"定时删除"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#定时删除"}},[t._v("#")]),t._v(" 定时删除")]),t._v(" "),r("p",[t._v("​\t\t定时删除对内存时最友好的，但是对CPU是最不友好的。服务器创建大量的定时器，对CPU的消耗很大。可能对服务器的响应时间和吞吐量造成影响。")]),t._v(" "),r("p",[t._v("​\t\t此外，创建一个定时器要用Redis服务器中的时间事件，而时间事件的用"),r("code",[t._v("无序链表")]),t._v("来实现的，查找一个事件的时间复杂度为O（N）。比较低效。")]),t._v(" "),r("h4",{attrs:{id:"惰性删除"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#惰性删除"}},[t._v("#")]),t._v(" 惰性删除")]),t._v(" "),r("p",[t._v("​\t\t惰性删除对CPU是最友好的，对内存是最不友好的，因为过期的键持续保存在内存中，只有等到下一次取出时才会释放。")]),t._v(" "),r("p",[t._v("​\t\t过多的过期键无法被删除，甚至可以看作这是一种内存泄漏。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572519069530.png",alt:"1572519069530"}})]),t._v(" "),r("h4",{attrs:{id:"定期删除"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#定期删除"}},[t._v("#")]),t._v(" 定期删除")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572519161676.png",alt:"1572519161676"}})]),t._v(" "),r("h3",{attrs:{id:"重点-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-3"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572520345966.png",alt:"1572520345966"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572520358928.png",alt:"1572520358928"}})]),t._v(" "),r("h2",{attrs:{id:"rdb持久化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rdb持久化"}},[t._v("#")]),t._v(" RDB持久化")]),t._v(" "),r("p",[t._v("​\t\t因为Redis是内存数据库，如果没有办法将内存中的数据存到磁盘，那么服务器一旦退出，服务器中的数据库状态也会消失不见。")]),t._v(" "),r("p",[t._v("​\t\t解决这个问题，需要使用Redis的RDB的持久化功能。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572572978066.png",alt:"1572572978066"}})]),t._v(" "),r("h3",{attrs:{id:"rbd文件的生成和载入"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rbd文件的生成和载入"}},[t._v("#")]),t._v(" RBD文件的生成和载入")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573069803.png",alt:"1572573069803"}})]),t._v(" "),r("p",[t._v("Redis没有主动载入RDB文件的命令，只要Redis服务器启动时检测到RDB文件存在就会自动载入，RDB载入时，服务器会处于阻塞状态。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573141765.png",alt:"1572573141765"}})]),t._v(" "),r("h4",{attrs:{id:"命令执行时的服务器状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#命令执行时的服务器状态"}},[t._v("#")]),t._v(" 命令执行时的服务器状态")]),t._v(" "),r("h5",{attrs:{id:"执行save"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#执行save"}},[t._v("#")]),t._v(" 执行save")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573386817.png",alt:"1572573386817"}})]),t._v(" "),r("h5",{attrs:{id:"执行bgsave"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#执行bgsave"}},[t._v("#")]),t._v(" 执行bgsave")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573412119.png",alt:"1572573412119"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573479759.png",alt:"1572573479759"}})]),t._v(" "),r("h3",{attrs:{id:"间隔性保存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#间隔性保存"}},[t._v("#")]),t._v(" 间隔性保存")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573563666.png",alt:"1572573563666"}})]),t._v(" "),r("h4",{attrs:{id:"dirty计数器和lastsave属性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#dirty计数器和lastsave属性"}},[t._v("#")]),t._v(" dirty计数器和lastsave属性")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573707402.png",alt:"1572573707402"}})]),t._v(" "),r("h3",{attrs:{id:"rdb文件结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rdb文件结构"}},[t._v("#")]),t._v(" RDB文件结构")]),t._v(" "),r("p",[t._v("​\t\t"),r("strong",[t._v("RDB文件保存的是二进制数据。")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572573919351.png",alt:"1572573919351"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572574050519.png",alt:"1572574050519"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572574080410.png",alt:"1572574080410"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572574163677.png",alt:"1572574163677"}})]),t._v(" "),r("h4",{attrs:{id:"字符串对象-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#字符串对象-2"}},[t._v("#")]),t._v(" 字符串对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575606389.png",alt:"1572575606389"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575619783.png",alt:"1572575619783"}})]),t._v(" "),r("h4",{attrs:{id:"列表对象-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#列表对象-2"}},[t._v("#")]),t._v(" 列表对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575697343.png",alt:"1572575697343"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575713218.png",alt:"1572575713218"}})]),t._v(" "),r("h4",{attrs:{id:"集合对象-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#集合对象-2"}},[t._v("#")]),t._v(" 集合对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575730353.png",alt:"1572575730353"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575739734.png",alt:"1572575739734"}})]),t._v(" "),r("h4",{attrs:{id:"哈希表对象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#哈希表对象"}},[t._v("#")]),t._v(" 哈希表对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575767125.png",alt:"1572575767125"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575784527.png",alt:"1572575784527"}})]),t._v(" "),r("h4",{attrs:{id:"有序集合对象-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#有序集合对象-2"}},[t._v("#")]),t._v(" 有序集合对象")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575809608.png",alt:"1572575809608"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572575824983.png",alt:"1572575824983"}})]),t._v(" "),r("h3",{attrs:{id:"重点-4"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-4"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572576142994.png",alt:"1572576142994"}})]),t._v(" "),r("h2",{attrs:{id:"aof持久化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#aof持久化"}},[t._v("#")]),t._v(" AOF持久化")]),t._v(" "),r("p",[t._v("​\t\t与RDB持久化通过"),r("strong",[t._v("保存数据库中的键值对")]),t._v("来记录数据库状态不同，AOF持久化是通过"),r("strong",[t._v("保存Redis服务器所执行的写命令")]),t._v("来记录数据库状态的。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572576312974.png",alt:"1572576312974"}})]),t._v(" "),r("h3",{attrs:{id:"aof文件的载入与数据还原"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#aof文件的载入与数据还原"}},[t._v("#")]),t._v(" AOF文件的载入与数据还原")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572581504833.png",alt:"1572581504833"}})]),t._v(" "),r("h3",{attrs:{id:"aof重写"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#aof重写"}},[t._v("#")]),t._v(" AOF重写")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572581578352.png",alt:"1572581578352"}})]),t._v(" "),r("h4",{attrs:{id:"aof重写原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#aof重写原理"}},[t._v("#")]),t._v(" AOF重写原理")]),t._v(" "),r("p",[t._v("​\t\t通过读取某个键的值来保存一条Redis语句来记录键值对，代替之前记录这个键值对的多个命令，而不是保存多条关于该键的值操作语句。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572581809572.png",alt:"1572581809572"}})]),t._v(" "),r("h4",{attrs:{id:"aof后台重写"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#aof后台重写"}},[t._v("#")]),t._v(" AOF后台重写")]),t._v(" "),r("p",[t._v("​\t\tAOF重写程序会进行大量的写操作，导致调用这个函数的线程被长时间阻塞，因为Redis服务器使用单个线程来处理命令请求，所以在重写AOF文件期间，Redis将无法处理客户端的其它命令请求。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572582028316.png",alt:"1572582028316"}})]),t._v(" "),r("h3",{attrs:{id:"重点-5"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-5"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572582181870.png",alt:"1572582181870"}})]),t._v(" "),r("h2",{attrs:{id:"文件事件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#文件事件"}},[t._v("#")]),t._v(" 文件事件")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572584219398.png",alt:"1572584219398"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572659440383.png",alt:"1572659440383"}})]),t._v(" "),r("h2",{attrs:{id:"时间事件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#时间事件"}},[t._v("#")]),t._v(" 时间事件")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572659507793.png",alt:"1572659507793"}})]),t._v(" "),r("h3",{attrs:{id:"实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572659556702.png",alt:"1572659556702"}})]),t._v(" "),r("h2",{attrs:{id:"重点-6"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-6"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572659719431.png",alt:"1572659719431"}})]),t._v(" "),r("h2",{attrs:{id:"客户端"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#客户端"}},[t._v("#")]),t._v(" 客户端")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572659866002.png",alt:"1572659866002"}})]),t._v(" "),r("p",[t._v("​\t\tRedis"),r("strong",[t._v("服务器状态结构的clients")]),t._v("属性是一个链表，这个链表保存了所有与服务器连接的客户端的状态结构，对客户端执行批量操作，或查找某个客户端。都可以通过遍历clients链表来完成。")]),t._v(" "),r("h3",{attrs:{id:"重点-7"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-7"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572660697182.png",alt:"1572660697182"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572660712062.png",alt:"1572660712062"}})]),t._v(" "),r("h2",{attrs:{id:"服务器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#服务器"}},[t._v("#")]),t._v(" 服务器")]),t._v(" "),r("h3",{attrs:{id:"命令执行过程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#命令执行过程"}},[t._v("#")]),t._v(" 命令执行过程")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572660837782.png",alt:"1572660837782"}})]),t._v(" "),r("h3",{attrs:{id:"servercron函数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#servercron函数"}},[t._v("#")]),t._v(" serverCron函数")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572661396021.png",alt:"1572661396021"}})]),t._v(" "),r("h4",{attrs:{id:"更新服务器时间缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#更新服务器时间缓存"}},[t._v("#")]),t._v(" 更新服务器时间缓存"),r("img",{attrs:{src:"F:%5CtyporaImg%5C1572661498731.png",alt:"1572661498731"}})]),t._v(" "),r("h4",{attrs:{id:"更新lru时钟"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#更新lru时钟"}},[t._v("#")]),t._v(" 更新LRU时钟")]),t._v(" "),r("p",[t._v("​\t\t也是服务器时间缓存的一种，每个"),r("code",[t._v("Redis")]),t._v("对象都会有一个"),r("code",[t._v("lru")]),t._v("属性，这个属性保存了"),r("strong",[t._v("对象最后一次被命令访问的时间")]),t._v(".")]),t._v(" "),r("h4",{attrs:{id:"更新服务器每秒执行命令的次数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#更新服务器每秒执行命令的次数"}},[t._v("#")]),t._v(" 更新服务器每秒执行命令的次数")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572661719175.png",alt:"1572661719175"}})]),t._v(" "),r("h4",{attrs:{id:"更新服务器内存峰值记录"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#更新服务器内存峰值记录"}},[t._v("#")]),t._v(" 更新服务器内存峰值记录")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572661786280.png",alt:"1572661786280"}})]),t._v(" "),r("h4",{attrs:{id:"处理sigterm信号"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#处理sigterm信号"}},[t._v("#")]),t._v(" 处理sigterm信号"),r("img",{attrs:{src:"F:%5CtyporaImg%5C1572661850163.png",alt:"1572661850163"}})]),t._v(" "),r("p",[t._v("​\t\t当"),r("code",[t._v("serverCron")]),t._v("函数执行的时候,会检查服务器状态的"),r("code",[t._v("shutdown_asap")]),t._v("属性,并根据属性的值决定是否关闭服务器.")]),t._v(" "),r("h4",{attrs:{id:"管理客户端资源"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#管理客户端资源"}},[t._v("#")]),t._v(" 管理客户端资源")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572661942160.png",alt:"1572661942160"}})]),t._v(" "),r("h4",{attrs:{id:"管理数据库资源"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#管理数据库资源"}},[t._v("#")]),t._v(" 管理数据库资源")]),t._v(" "),r("p",[t._v("​\t\t删除过期键,并在有需要时,对字典进行收缩操作.")]),t._v(" "),r("h4",{attrs:{id:"执行被延迟的bgrewriteaof"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#执行被延迟的bgrewriteaof"}},[t._v("#")]),t._v(" 执行被延迟的BGREWRITEAOF")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572662015874.png",alt:"1572662015874"}})]),t._v(" "),r("p",[t._v("​\t\t当"),r("code",[t._v("serverCron")]),t._v("函数执行的时候,会检查"),r("code",[t._v("BGSAVE")]),t._v("命令或者"),r("code",[t._v("BGREWRITEAOF")]),t._v("命令是否正在执行,如果这两个命令都没在执行,并且"),r("code",[t._v("aof_rewrite_scheduled")]),t._v("属性的值为"),r("strong",[t._v("1")]),t._v(",那么服务器就会执行之前被推延的"),r("code",[t._v("BGREWRITEAOF")]),t._v("命令.")]),t._v(" "),r("h4",{attrs:{id:"查看持久化操作的运行状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查看持久化操作的运行状态"}},[t._v("#")]),t._v(" 查看持久化操作的运行状态")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572662677562.png",alt:"1572662677562"}})]),t._v(" "),r("h3",{attrs:{id:"初始化服务器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#初始化服务器"}},[t._v("#")]),t._v(" 初始化服务器")]),t._v(" "),r("p",[t._v("​\t\t初始化server的工作由"),r("code",[t._v("initServerConfig")]),t._v("函数完成.")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572668980443.png",alt:"1572668980443"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572668985780.png",alt:"1572668985780"}})]),t._v(" "),r("h3",{attrs:{id:"重点-8"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-8"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572669236443.png",alt:"1572669236443"}})]),t._v(" "),r("h1",{attrs:{id:"多机数据库的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#多机数据库的实现"}},[t._v("#")]),t._v(" 多机数据库的实现")]),t._v(" "),r("h2",{attrs:{id:"复制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#复制"}},[t._v("#")]),t._v(" 复制")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572669337016.png",alt:"1572669337016"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572669360025.png",alt:"1572669360025"}})]),t._v(" "),r("h3",{attrs:{id:"旧版复制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#旧版复制"}},[t._v("#")]),t._v(" 旧版复制")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572669698978.png",alt:"1572669698978"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572669754550.png",alt:"1572669754550"}})]),t._v(" "),r("h4",{attrs:{id:"主从服务器同步过程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#主从服务器同步过程"}},[t._v("#")]),t._v(" 主从服务器同步过程")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572758938525.png",alt:"1572758938525"}})]),t._v(" "),r("h4",{attrs:{id:"旧版同步的缺陷"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#旧版同步的缺陷"}},[t._v("#")]),t._v(" 旧版同步的缺陷")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572759240640.png",alt:"1572759240640"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572767985491.png",alt:"1572767985491"}})]),t._v(" "),r("h3",{attrs:{id:"新版复制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#新版复制"}},[t._v("#")]),t._v(" 新版复制")]),t._v(" "),r("p",[t._v("​\t\t解决了旧版复制功能在断线后重复制效率低下的问题")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572768073578.png",alt:"1572768073578"}})]),t._v(" "),r("h3",{attrs:{id:"复制的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#复制的实现"}},[t._v("#")]),t._v(" 复制的实现")]),t._v(" "),r("ul",[r("li",[t._v("设置主服务器的地址和端口")]),t._v(" "),r("li",[t._v("建立套接字连接")]),t._v(" "),r("li",[t._v("发送ping命令")]),t._v(" "),r("li",[t._v("身份验证")]),t._v(" "),r("li",[t._v("发送从服务器端口信息（监听端口号）")]),t._v(" "),r("li",[t._v("同步")]),t._v(" "),r("li",[t._v("命令广播")])]),t._v(" "),r("h3",{attrs:{id:"重点-9"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-9"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572768999135.png",alt:"1572768999135"}})]),t._v(" "),r("h2",{attrs:{id:"sentinel"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#sentinel"}},[t._v("#")]),t._v(" Sentinel")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572833650451.png",alt:"1572833650451"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572833663329.png",alt:"1572833663329"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572833673711.png",alt:"1572833673711"}})]),t._v(" "),r("h2",{attrs:{id:"集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#集群"}},[t._v("#")]),t._v(" 集群")]),t._v(" "),r("p",[t._v("​\t\tRedis集群是Redis提供的分布式数据库方案，集群通过分片（sharding）来进行数据共享，并提供复制和故障转移功能。")]),t._v(" "),r("h3",{attrs:{id:"节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#节点"}},[t._v("#")]),t._v(" 节点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572833865990.png",alt:"1572833865990"}})]),t._v(" "),r("h4",{attrs:{id:"启动节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#启动节点"}},[t._v("#")]),t._v(" 启动节点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572834133480.png",alt:"1572834133480"}})]),t._v(" "),r("h4",{attrs:{id:"集群数据结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#集群数据结构"}},[t._v("#")]),t._v(" 集群数据结构")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572834524269.png",alt:"1572834524269"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572834568405.png",alt:"1572834568405"}})]),t._v(" "),r("h3",{attrs:{id:"槽指派"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#槽指派"}},[t._v("#")]),t._v(" 槽指派")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572834654948.png",alt:"1572834654948"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572834737207.png",alt:"1572834737207"}})]),t._v(" "),r("p",[t._v("​\t\t如果客户端发送命令对应键的槽不属于当前的服务器（节点），那么服务器会返回MOVED错误给客户端，并携带正确的槽所属服务器的地址和端口，让客户端重新执行命令。")]),t._v(" "),r("h3",{attrs:{id:"重点-10"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-10"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922608951.png",alt:"1572922608951"}})]),t._v(" "),r("h2",{attrs:{id:"发布订阅"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发布订阅"}},[t._v("#")]),t._v(" 发布订阅")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572921143198.png",alt:"1572921143198"}})]),t._v(" "),r("p",[t._v("​\t\t还支持相匹配的模式的订阅，执行"),r("code",[t._v("subscribe news.[ie]t")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572921214917.png",alt:"1572921214917"}})]),t._v(" "),r("h3",{attrs:{id:"频道的订阅与退订"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#频道的订阅与退订"}},[t._v("#")]),t._v(" 频道的订阅与退订")]),t._v(" "),r("p",[t._v("pubsub_channels字典中记录了被订阅频道和订阅客户端的信息（链表）。")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572921363177.png",alt:"1572921363177"}})]),t._v(" "),r("p",[t._v("退订使用命令"),r("code",[t._v("UNSUBSCTIBE")])]),t._v(" "),r("h3",{attrs:{id:"模式的订阅与退订"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#模式的订阅与退订"}},[t._v("#")]),t._v(" 模式的订阅与退订")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572921715855.png",alt:"1572921715855"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572921740978.png",alt:"1572921740978"}})]),t._v(" "),r("ul",[r("li",[r("p",[t._v("订阅使用命令"),r("code",[t._v("PSUBSCRIBE")])])]),t._v(" "),r("li",[r("p",[t._v("退订使用命令"),r("code",[t._v("PUNSUBSCRIBE")])])])]),t._v(" "),r("h3",{attrs:{id:"发送消息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#发送消息"}},[t._v("#")]),t._v(" 发送消息")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572921951290.png",alt:"1572921951290"}})]),t._v(" "),r("h3",{attrs:{id:"查看订阅信息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#查看订阅信息"}},[t._v("#")]),t._v(" 查看订阅信息")]),t._v(" "),r("ul",[r("li",[t._v("pubsub channels")])]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922067543.png",alt:"1572922067543"}})]),t._v(" "),r("ul",[r("li",[r("p",[t._v("pubsub numsub")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922212151.png",alt:"1572922212151"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922232907.png",alt:"1572922232907"}})])]),t._v(" "),r("li",[r("p",[t._v("pubsub numpat")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922538860.png",alt:"1572922538860"}})])])]),t._v(" "),r("h3",{attrs:{id:"重点-11"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#重点-11"}},[t._v("#")]),t._v(" 重点")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922579721.png",alt:"1572922579721"}})]),t._v(" "),r("h2",{attrs:{id:"事务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[t._v("#")]),t._v(" 事务")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922913573.png",alt:"1572922913573"}})]),t._v(" "),r("h3",{attrs:{id:"事务开始"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#事务开始"}},[t._v("#")]),t._v(" 事务开始")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572922948755.png",alt:"1572922948755"}})]),t._v(" "),r("h3",{attrs:{id:"执行事务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#执行事务"}},[t._v("#")]),t._v(" 执行事务")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572925730807.png",alt:"1572925730807"}})]),t._v(" "),r("h3",{attrs:{id:"watch命令的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#watch命令的实现"}},[t._v("#")]),t._v(" WATCH命令的实现")]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572925804332.png",alt:"1572925804332"}})]),t._v(" "),r("p",[r("img",{attrs:{src:"F:%5CtyporaImg%5C1572925847048.png",alt:"1572925847048"}})]),t._v(" "),r("h3",{attrs:{id:"事务的acid性质"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#事务的acid性质"}},[t._v("#")]),t._v(" 事务的ACID性质")]),t._v(" "),r("h3",{attrs:{id:""}},[r("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")]),t._v(" "),r("img",{attrs:{src:"F:%5CtyporaImg%5C1572926013518.png",alt:"1572926013518"}})])])}),[],!1,null,null,null);a.default=v.exports}}]);